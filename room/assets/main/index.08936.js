System.register("chunks:///main.js",["./FaderManager-8f6e2d8b.js","cc","./index-e6d8f024.js","./index-f150e2cd.js","./index-2358a077.js"],(function(){"use strict";var t,e,n,i,s,a,r,o,h,c,u,l,p,f,T,d,v,E,m,M,I,R,O,L,y,S,g,C,A,F,_,K,B,D,H,P,w,b,N,k,x,G,U,W,Y;return{setters:[function(p){t=p._,e=p.a,n=p.b,i=p.c,s=p.d,a=p.E,r=p.D,o=p.e,h=p.R,c=p.F,u=p.f,l=p.g},function(t){p=t.cclegacy,f=t._decorator,T=t.Component,d=t.UITransform,v=t.Sprite,E=t.AnimationClip,m=t.animation,M=t.SpriteFrame,I=t.Animation,R=t.game,O=t.director,L=t.ProgressBar,y=t.resources,S=t.Node},function(t){g=t.T,C=t.P,A=t.D,F=t.E,_=t.a,K=t.b,B=t.F,D=t.S,H=t.c,P=t.C,w=t.d,b=t.e,N=t.f,k=t.g},function(t){x=t.r,G=t.s,U=t.a,W=t.c},function(t){Y=t.l}],execute:function(){var V;p._RF.push({},"cc8883gQjNI2ImNd1sdroO/","TileManager",void 0);var X,Z=f.ccclass,z=55,q=55,j=Z("TileManager")(V=function(s){function a(){for(var t,i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return t=s.call.apply(s,[this].concat(a))||this,e(n(t),"type",void 0),e(n(t),"moveable",void 0),e(n(t),"turnable",void 0),t}return t(a,s),a.prototype.init=function(){var t=i((function*(t,e,n,i){this.type=t,this.type===g.WALL_LEFT_TOP||this.type===g.WALL_ROW||this.type===g.WALL_RIGHT_TOP||this.type===g.WALL_LEFT_BOTTOM||this.type===g.WALL_RIGHT_BOTTOM||this.type===g.WALL_COLUMN?(this.moveable=!1,this.turnable=!1):this.type===g.CLIFF_LEFT||this.type===g.CLIFF_CENTER||this.type===g.CLIFF_RIGHT?(this.moveable=!1,this.turnable=!0):this.type===g.FLOOR&&(this.moveable=!0,this.turnable=!0);var s=this.getComponent(d);this.node.addComponent(v).spriteFrame=e,s.setContentSize(z,q),this.node.setPosition(n*z,-i*q)}));return function(e,n,i,s){return t.apply(this,arguments)}}(),a}(T))||V;p._RF.pop(),p._RF.push({},"f8eedd9+RNKF7Ym80b7VpSj","EntityManager",void 0);var J,Q=(0,f.ccclass)("EntityManager")(X=function(i){function a(){for(var t,s=arguments.length,a=new Array(s),r=0;r<s;r++)a[r]=arguments[r];return t=i.call.apply(i,[this].concat(a))||this,e(n(t),"id",x(12)),e(n(t),"fsm",void 0),e(n(t),"transform",void 0),e(n(t),"_state",void 0),e(n(t),"_direction",void 0),e(n(t),"type",void 0),e(n(t),"x",void 0),e(n(t),"y",void 0),t}t(a,i);var r=a.prototype;return r.init=function(t){this.node.addComponent(v).sizeMode=v.SizeMode.CUSTOM,this.transform=this.getComponent(d),this.transform.setContentSize(220,220),this.x=t.x,this.y=t.y,this.direction=t.direction,this.state=t.state},r.onDestroy=function(){},r.update=function(){this.node.setPosition(this.x*z-82.5,-this.y*q+82.5)},s(a,[{key:"direction",get:function(){return this._direction},set:function(t){this._direction=t,this.fsm.setParams(C.DIRECTION,A[this._direction])}},{key:"state",get:function(){return this._state},set:function(t){this._state=t,this.fsm.setParams(t,!0)}}]),a}(T))||X;p._RF.pop(),p._RF.push({},"22ca897xZxAZadAvpfzW0b5","EnemyManager",void 0);var $,tt=(0,f.ccclass)("EnemyManager")(J=function(e){function n(){return e.apply(this,arguments)||this}t(n,e);var i=n.prototype;return i.init=function(t){e.prototype.init.call(this,t),a.Instance.on(F.PLAYER_BORN,this.onChangeDirection,this),a.Instance.on(F.ATTACK_ENEMY,this.onDead,this),a.Instance.on(F.PLAYER_MOVE_END,this.onChangeDirection,this),this.onChangeDirection(!0)},i.onDestroy=function(){e.prototype.onDestroy.call(this),a.Instance.off(F.PLAYER_BORN,this.onChangeDirection),a.Instance.off(F.ATTACK_ENEMY,this.onDead),a.Instance.off(F.PLAYER_MOVE_END,this.onChangeDirection)},i.onChangeDirection=function(t){if(void 0===t&&(t=!1),this.state!==_.DEATH&&r.Instance.player){var e=r.Instance.player,n=e.x,i=e.y,s=Math.abs(n-this.x),a=Math.abs(i-this.y);(s!==a||t)&&(n>=this.x&&i<=this.y?this.direction=s>=a?K.RIGHT:K.TOP:n<=this.x&&i<=this.y?this.direction=s>=a?K.LEFT:K.TOP:n<=this.x&&i>=this.y?this.direction=s>=a?K.LEFT:K.BOTTOM:n>=this.x&&i>=this.y&&(this.direction=s>=a?K.RIGHT:K.BOTTOM))}},i.onDead=function(t){this.state!==_.DEATH&&this.id===t&&(this.state=_.DEATH)},n}(Q))||J;p._RF.pop(),p._RF.push({},"31220R+XUJPU6HV+aMVilf1","StateMachine",void 0);var et=f.ccclass,nt=function(){return{type:B.TRIGGER,value:!1}},it=function(){return{type:B.NUMBER,value:0}},st=et("StateMachine")($=function(i){function a(){for(var t,s=arguments.length,a=new Array(s),r=0;r<s;r++)a[r]=arguments[r];return t=i.call.apply(i,[this].concat(a))||this,e(n(t),"_currentState",null),e(n(t),"params",new Map),e(n(t),"stateMachines",new Map),e(n(t),"animationComponent",void 0),e(n(t),"waitingList",[]),t}t(a,i);var r=a.prototype;return r.getParams=function(t){if(this.params.has(t))return this.params.get(t).value},r.setParams=function(t,e){this.params.has(t)&&(this.params.get(t).value=e,this.run(),this.resetTrigger())},r.resetTrigger=function(){for(var t,e=o(this.params);!(t=e()).done;){var n=t.value[1];n.type===B.TRIGGER&&(n.value=!1)}},s(a,[{key:"currentState",get:function(){return this._currentState},set:function(t){t&&(this._currentState=t,this._currentState.run())}}]),a}(T))||$;p._RF.pop(),p._RF.push({},"7d1d3dDqcpN9780JK1/BCfW","SubStateMachine",void 0);var at=function(){function t(t){e(this,"_currentState",null),e(this,"stateMachines",new Map),this.fsm=t}return s(t,[{key:"currentState",get:function(){return this._currentState},set:function(t){t&&(this._currentState=t,this._currentState.run())}}]),t}();p._RF.pop(),p._RF.push({},"83f3bk3kQdKeIv5JULZwPbu","DirectionSubStateMachine",void 0);var rt=function(e){function n(){return e.apply(this,arguments)||this}return t(n,e),n.prototype.run=function(){var t=this.fsm.params.get(C.DIRECTION).value;this.currentState=this.stateMachines.get(A[t])},n}(at);p._RF.pop(),p._RF.push({},"1d3b7qcDy1IGqr7nwT4iZm3","State",void 0);var ot=1/8,ht=function(){function t(t,n,i,s,a){void 0===i&&(i=E.WrapMode.Normal),void 0===s&&(s=ot),void 0===a&&(a=[]),e(this,"animationClip",void 0),this.fsm=t,this.spriteFrameDir=n,this.wrapMode=i,this.speed=s,this.events=a,this.init()}var n=t.prototype;return n.init=function(){var t=i((function*(){var t=this,e=new m.ObjectTrack;e.path=(new m.TrackPath).toComponent(v).toProperty("spriteFrame");var n=h.Instance.loadDir(this.spriteFrameDir,M);this.fsm.waitingList.push(n);var i=yield n,s=G(i).map((function(e,n){return[n*t.speed,e]}));e.channel.curve.assignSorted(s),this.animationClip=new E,this.animationClip.name=this.spriteFrameDir,this.animationClip.duration=s.length*this.speed,this.animationClip.addTrack(e),this.animationClip.wrapMode=this.wrapMode;for(var a,r=o(this.events);!(a=r()).done;){var c=a.value;this.animationClip.events.push(c)}this.animationClip.updateEventDatas()}));return function(){return t.apply(this,arguments)}}(),n.run=function(){var t;(null===(t=this.fsm.animationComponent.defaultClip)||void 0===t?void 0:t.name)!==this.animationClip.name&&(this.fsm.animationComponent.defaultClip=this.animationClip,this.fsm.animationComponent.play())},t}();p._RF.pop(),p._RF.push({},"f173edVKrBMZLAscPc5/OLo","DeathSubStateMachine",void 0);var ct="texture/ironskeleton/death",ut=function(e){function n(t){var n;return(n=e.call(this,t)||this).stateMachines.set(K.TOP,new ht(t,ct+"/top")),n.stateMachines.set(K.BOTTOM,new ht(t,ct+"/bottom")),n.stateMachines.set(K.LEFT,new ht(t,ct+"/left")),n.stateMachines.set(K.RIGHT,new ht(t,ct+"/right")),n}return t(n,e),n}(rt);p._RF.pop(),p._RF.push({},"c7ea4vP0ZhDNKtFE30bVa5r","IdleSubStateMachine",void 0);var lt,pt="texture/ironskeleton/idle",ft=function(e){function n(t){var n;return(n=e.call(this,t)||this).stateMachines.set(K.TOP,new ht(t,pt+"/top",E.WrapMode.Loop)),n.stateMachines.set(K.BOTTOM,new ht(t,pt+"/bottom",E.WrapMode.Loop)),n.stateMachines.set(K.LEFT,new ht(t,pt+"/left",E.WrapMode.Loop)),n.stateMachines.set(K.RIGHT,new ht(t,pt+"/right",E.WrapMode.Loop)),n}return t(n,e),n}(rt);p._RF.pop(),p._RF.push({},"68782wV8HhCfa6ekm9AeUZP","IronSkeletonStateMachine",void 0);var Tt,dt=(0,f.ccclass)("IronSkeletonStateMachine")(lt=function(e){function n(){return e.apply(this,arguments)||this}t(n,e);var s=n.prototype;return s.init=function(){var t=i((function*(){this.animationComponent=this.node.addComponent(I),this.initParams(),this.initStateMachines(),this.initAnimationEvent(),yield Promise.all(this.waitingList)}));return function(){return t.apply(this,arguments)}}(),s.initAnimationEvent=function(){},s.initParams=function(){this.params.set(C.IDLE,nt()),this.params.set(C.DEATH,nt()),this.params.set(C.DIRECTION,it())},s.initStateMachines=function(){this.stateMachines.set(C.IDLE,new ft(this)),this.stateMachines.set(C.DEATH,new ut(this))},s.run=function(){switch(this.currentState){case this.stateMachines.get(C.IDLE):case this.stateMachines.get(C.DEATH):this.params.get(C.DEATH).value?this.currentState=this.stateMachines.get(C.DEATH):this.params.get(C.IDLE).value?this.currentState=this.stateMachines.get(C.IDLE):this.currentState=this.currentState;break;default:this.currentState=this.stateMachines.get(C.IDLE)}},n}(st))||lt;p._RF.pop(),p._RF.push({},"02a45asaOtAKZAxKwe/CZnq","IronSkeletonManager",void 0);var vt=(0,f.ccclass)("IronSkeletonManager")(Tt=function(e){function n(){return e.apply(this,arguments)||this}return t(n,e),n.prototype.init=function(){var t=i((function*(t){this.fsm=this.addComponent(dt),yield this.fsm.init(),e.prototype.init.call(this,t)}));return function(e){return t.apply(this,arguments)}}(),n}(tt))||Tt;p._RF.pop(),p._RF.push({},"032f1gC8HNPAawJORmBFCmT","SpikesSubStateMachine",void 0);var Et=function(e){function n(){return e.apply(this,arguments)||this}return t(n,e),n.prototype.run=function(){var t=this.fsm.params.get(C.SPIKES_CUR_COUNT).value;this.currentState=this.stateMachines.get(D[t])},n}(at);p._RF.pop(),p._RF.push({},"0449atsP6hAE7SDWlRAX/ZB","IdleSubStateMachine",void 0);var mt="texture/woodenskeleton/idle",Mt=function(e){function n(t){var n;return(n=e.call(this,t)||this).stateMachines.set(K.TOP,new ht(t,mt+"/top",E.WrapMode.Loop)),n.stateMachines.set(K.BOTTOM,new ht(t,mt+"/bottom",E.WrapMode.Loop)),n.stateMachines.set(K.LEFT,new ht(t,mt+"/left",E.WrapMode.Loop)),n.stateMachines.set(K.RIGHT,new ht(t,mt+"/right",E.WrapMode.Loop)),n}return t(n,e),n}(rt);p._RF.pop(),p._RF.push({},"e7a6egW87pAuZpp9ND5dAMp","AttackSubStateMachine",void 0);var It="texture/woodenskeleton/attack",Rt=function(e){function n(t){var n;return(n=e.call(this,t)||this).stateMachines.set(K.TOP,new ht(t,It+"/top")),n.stateMachines.set(K.BOTTOM,new ht(t,It+"/bottom")),n.stateMachines.set(K.LEFT,new ht(t,It+"/left")),n.stateMachines.set(K.RIGHT,new ht(t,It+"/right")),n}return t(n,e),n}(rt);p._RF.pop(),p._RF.push({},"4692b5GdaBEEJvU/4+UN5W8","DeathSubStateMachine",void 0);var Ot,Lt="texture/woodenskeleton/death",yt=function(e){function n(t){var n;return(n=e.call(this,t)||this).stateMachines.set(K.TOP,new ht(t,Lt+"/top")),n.stateMachines.set(K.BOTTOM,new ht(t,Lt+"/bottom")),n.stateMachines.set(K.LEFT,new ht(t,Lt+"/left")),n.stateMachines.set(K.RIGHT,new ht(t,Lt+"/right")),n}return t(n,e),n}(rt);p._RF.pop(),p._RF.push({},"fe448NKl0dLP5XbtdE+pRER","WoodenSkeletonStateMachine",void 0);var St,gt=(0,f.ccclass)("WoodenSkeletonStateMachine")(Ot=function(e){function n(){return e.apply(this,arguments)||this}t(n,e);var s=n.prototype;return s.init=function(){var t=i((function*(){this.animationComponent=this.node.addComponent(I),this.initParams(),this.initStateMachines(),this.initAnimationEvent(),yield Promise.all(this.waitingList)}));return function(){return t.apply(this,arguments)}}(),s.initAnimationEvent=function(){var t=this;this.animationComponent.on(I.EventType.FINISHED,(function(){var e=t.animationComponent.defaultClip.name;["attack"].some((function(t){return e.includes(t)}))&&(t.node.getComponent(Q).state=_.IDLE)}))},s.initParams=function(){this.params.set(C.IDLE,nt()),this.params.set(C.ATTACK,nt()),this.params.set(C.DEATH,nt()),this.params.set(C.DIRECTION,it())},s.initStateMachines=function(){this.stateMachines.set(C.IDLE,new Mt(this)),this.stateMachines.set(C.ATTACK,new Rt(this)),this.stateMachines.set(C.DEATH,new yt(this))},s.run=function(){switch(this.currentState){case this.stateMachines.get(C.IDLE):case this.stateMachines.get(C.ATTACK):case this.stateMachines.get(C.DEATH):this.params.get(C.DEATH).value?this.currentState=this.stateMachines.get(C.DEATH):this.params.get(C.ATTACK).value?this.currentState=this.stateMachines.get(C.ATTACK):this.params.get(C.IDLE).value?this.currentState=this.stateMachines.get(C.IDLE):this.currentState=this.currentState;break;default:this.currentState=this.stateMachines.get(C.IDLE)}},n}(st))||Ot;p._RF.pop(),p._RF.push({},"6a65eB7aJFB147ornLn6o5A","WoodenSkeletonManager",void 0);var Ct=(0,f.ccclass)("WoodenSkeletonManager")(St=function(e){function n(){return e.apply(this,arguments)||this}t(n,e);var s=n.prototype;return s.init=function(){var t=i((function*(t){this.fsm=this.addComponent(gt),yield this.fsm.init(),e.prototype.init.call(this,t),a.Instance.on(F.PLAYER_MOVE_END,this.onAttack,this)}));return function(e){return t.apply(this,arguments)}}(),s.onDestroy=function(){e.prototype.onDestroy.call(this),a.Instance.off(F.PLAYER_MOVE_END,this.onAttack)},s.onAttack=function(){if(this.state!==_.DEATH){var t=r.Instance.player,e=t.targetX,n=t.targetY,i=t.state;(e===this.x&&Math.abs(n-this.y)<=1||n===this.y&&Math.abs(e-this.x)<=1)&&i!==_.DEATH&&i!==_.AIRDEATH?(this.state=_.ATTACK,a.Instance.emit(F.ATTACK_PLAYER,_.DEATH)):this.state=_.IDLE}},n}(tt))||St;p._RF.pop(),p._RF.push({},"2e19eBKUZNMtIFUU07cLdGH","IdleSubStateMachine",void 0);var At="texture/player/idle",Ft=function(e){function n(t){var n;return(n=e.call(this,t)||this).stateMachines.set(K.TOP,new ht(t,At+"/top",E.WrapMode.Loop)),n.stateMachines.set(K.BOTTOM,new ht(t,At+"/bottom",E.WrapMode.Loop)),n.stateMachines.set(K.LEFT,new ht(t,At+"/left",E.WrapMode.Loop)),n.stateMachines.set(K.RIGHT,new ht(t,At+"/right",E.WrapMode.Loop)),n}return t(n,e),n}(rt);p._RF.pop(),p._RF.push({},"7474d3eV6pCmJD98KGLuzl7","AttackSubStateMachine",void 0);var _t="texture/player/attack",Kt=function(e){function n(t){var n;return(n=e.call(this,t)||this).stateMachines.set(K.TOP,new ht(t,_t+"/top",E.WrapMode.Normal,ot,[{frame:.5,func:"onAttackShake",params:[H.TOP]}])),n.stateMachines.set(K.BOTTOM,new ht(t,_t+"/bottom",E.WrapMode.Normal,ot,[{frame:.5,func:"onAttackShake",params:[H.BOTTOM]}])),n.stateMachines.set(K.LEFT,new ht(t,_t+"/left",E.WrapMode.Normal,ot,[{frame:.5,func:"onAttackShake",params:[H.LEFT]}])),n.stateMachines.set(K.RIGHT,new ht(t,_t+"/right",E.WrapMode.Normal,ot,[{frame:.5,func:"onAttackShake",params:[H.RIGHT]}])),n}return t(n,e),n}(rt);p._RF.pop(),p._RF.push({},"c6610G/Sc1MPY5kaXWx4DW+","TurnRightSubStateMachine",void 0);var Bt="texture/player/turnright",Dt=function(e){function n(t){var n;return(n=e.call(this,t)||this).stateMachines.set(K.TOP,new ht(t,Bt+"/top")),n.stateMachines.set(K.BOTTOM,new ht(t,Bt+"/bottom")),n.stateMachines.set(K.LEFT,new ht(t,Bt+"/left")),n.stateMachines.set(K.RIGHT,new ht(t,Bt+"/right")),n}return t(n,e),n}(rt);p._RF.pop(),p._RF.push({},"e8831tv4YxNsrP4yymA60Fo","TurnLeftSubStateMachine",void 0);var Ht="texture/player/turnleft",Pt=function(e){function n(t){var n;return(n=e.call(this,t)||this).stateMachines.set(K.TOP,new ht(t,Ht+"/top")),n.stateMachines.set(K.BOTTOM,new ht(t,Ht+"/bottom")),n.stateMachines.set(K.LEFT,new ht(t,Ht+"/left")),n.stateMachines.set(K.RIGHT,new ht(t,Ht+"/right")),n}return t(n,e),n}(rt);p._RF.pop(),p._RF.push({},"2b7dclgdN1O94F08lm/yoJb","DeathSubStateMachine",void 0);var wt="texture/player/death",bt=function(e){function n(t){var n;return(n=e.call(this,t)||this).stateMachines.set(K.TOP,new ht(t,wt+"/top")),n.stateMachines.set(K.BOTTOM,new ht(t,wt+"/bottom")),n.stateMachines.set(K.LEFT,new ht(t,wt+"/left")),n.stateMachines.set(K.RIGHT,new ht(t,wt+"/right")),n}return t(n,e),n}(rt);p._RF.pop(),p._RF.push({},"3a504YKPHBOLZ380IDHrn1M","AirDeathSubStateMachine",void 0);var Nt="texture/player/airdeath",kt=function(e){function n(t){var n;return(n=e.call(this,t)||this).stateMachines.set(K.TOP,new ht(t,Nt+"/top")),n.stateMachines.set(K.BOTTOM,new ht(t,Nt+"/bottom")),n.stateMachines.set(K.LEFT,new ht(t,Nt+"/left")),n.stateMachines.set(K.RIGHT,new ht(t,Nt+"/right")),n}return t(n,e),n}(rt);p._RF.pop(),p._RF.push({},"4efe8U9XsVHkpeY7UrID8Xw","BlockFrontSubStateMachine",void 0);var xt="texture/player/blockfront",Gt=function(e){function n(t){var n;return(n=e.call(this,t)||this).stateMachines.set(K.TOP,new ht(t,xt+"/top")),n.stateMachines.set(K.BOTTOM,new ht(t,xt+"/bottom")),n.stateMachines.set(K.LEFT,new ht(t,xt+"/left")),n.stateMachines.set(K.RIGHT,new ht(t,xt+"/right")),n}return t(n,e),n}(rt);p._RF.pop(),p._RF.push({},"e1304HBmZlEpYNIfnXg25+h","BlockRightSubStateMachine",void 0);var Ut="texture/player/blockright",Wt=function(e){function n(t){var n;return(n=e.call(this,t)||this).stateMachines.set(K.TOP,new ht(t,Ut+"/top")),n.stateMachines.set(K.BOTTOM,new ht(t,Ut+"/bottom")),n.stateMachines.set(K.LEFT,new ht(t,Ut+"/left")),n.stateMachines.set(K.RIGHT,new ht(t,Ut+"/right")),n}return t(n,e),n}(rt);p._RF.pop(),p._RF.push({},"5464eFNeUVGa7VqREhLbkVh","BlockTurnLeftSubStateMachine",void 0);var Yt="texture/player/blockturnleft",Vt=function(e){function n(t){var n;return(n=e.call(this,t)||this).stateMachines.set(K.TOP,new ht(t,Yt+"/top")),n.stateMachines.set(K.BOTTOM,new ht(t,Yt+"/bottom")),n.stateMachines.set(K.LEFT,new ht(t,Yt+"/left")),n.stateMachines.set(K.RIGHT,new ht(t,Yt+"/right")),n}return t(n,e),n}(rt);p._RF.pop(),p._RF.push({},"1ada5KTd7xMdr2DDlq4nefC","BlockBackSubStateMachine",void 0);var Xt="texture/player/blockback",Zt=function(e){function n(t){var n;return(n=e.call(this,t)||this).stateMachines.set(K.TOP,new ht(t,Xt+"/top")),n.stateMachines.set(K.BOTTOM,new ht(t,Xt+"/bottom")),n.stateMachines.set(K.LEFT,new ht(t,Xt+"/left")),n.stateMachines.set(K.RIGHT,new ht(t,Xt+"/right")),n}return t(n,e),n}(rt);p._RF.pop(),p._RF.push({},"86c5dRpZ5NMg6i/8oLqtvEt","BlockTurnRightSubStateMachine",void 0);var zt="texture/player/blockturnright",qt=function(e){function n(t){var n;return(n=e.call(this,t)||this).stateMachines.set(K.TOP,new ht(t,zt+"/top")),n.stateMachines.set(K.BOTTOM,new ht(t,zt+"/bottom")),n.stateMachines.set(K.LEFT,new ht(t,zt+"/left")),n.stateMachines.set(K.RIGHT,new ht(t,zt+"/right")),n}return t(n,e),n}(rt);p._RF.pop(),p._RF.push({},"e2027B1tkxI8oltfoWrP4FT","BlockLeftSubStateMachine",void 0);var jt,Jt="texture/player/blockleft",Qt=function(e){function n(t){var n;return(n=e.call(this,t)||this).stateMachines.set(K.TOP,new ht(t,Jt+"/top")),n.stateMachines.set(K.BOTTOM,new ht(t,Jt+"/bottom")),n.stateMachines.set(K.LEFT,new ht(t,Jt+"/left")),n.stateMachines.set(K.RIGHT,new ht(t,Jt+"/right")),n}return t(n,e),n}(rt);p._RF.pop(),p._RF.push({},"af8b7y6r9NKrrGXEKamsXtk","PlayerStateMachine",void 0);var $t,te=f.ccclass,ee=(f.property,te("PlayerStateMachine")(jt=function(e){function n(){return e.apply(this,arguments)||this}t(n,e);var s=n.prototype;return s.init=function(){var t=i((function*(){this.animationComponent=this.node.addComponent(I),this.initParams(),this.initStateMachines(),this.initAnimationEvent(),yield Promise.all(this.waitingList)}));return function(){return t.apply(this,arguments)}}(),s.initAnimationEvent=function(){var t=this;this.animationComponent.on(I.EventType.FINISHED,(function(){var e=t.animationComponent.defaultClip.name;["block","turn","attack"].some((function(t){return e.includes(t)}))&&(t.node.getComponent(Q).state=_.IDLE)}))},s.initParams=function(){this.params.set(C.IDLE,nt()),this.params.set(C.ATTACK,nt()),this.params.set(C.TURNLEFT,nt()),this.params.set(C.TURNRIGHT,nt()),this.params.set(C.BLOCKFRONT,nt()),this.params.set(C.BLOCKBACK,nt()),this.params.set(C.BLOCKLEFT,nt()),this.params.set(C.BLOCKRIGHT,nt()),this.params.set(C.BLOCKTURNLEFT,nt()),this.params.set(C.BLOCKTURNRIGHT,nt()),this.params.set(C.DEATH,nt()),this.params.set(C.AIRDEATH,nt()),this.params.set(C.DIRECTION,it())},s.initStateMachines=function(){this.stateMachines.set(C.IDLE,new Ft(this)),this.stateMachines.set(C.TURNLEFT,new Pt(this)),this.stateMachines.set(C.TURNRIGHT,new Dt(this)),this.stateMachines.set(C.BLOCKFRONT,new Gt(this)),this.stateMachines.set(C.BLOCKBACK,new Zt(this)),this.stateMachines.set(C.BLOCKLEFT,new Qt(this)),this.stateMachines.set(C.BLOCKRIGHT,new Wt(this)),this.stateMachines.set(C.BLOCKTURNLEFT,new Vt(this)),this.stateMachines.set(C.BLOCKTURNRIGHT,new qt(this)),this.stateMachines.set(C.ATTACK,new Kt(this)),this.stateMachines.set(C.DEATH,new bt(this)),this.stateMachines.set(C.AIRDEATH,new kt(this))},s.run=function(){switch(this.currentState){case this.stateMachines.get(C.IDLE):case this.stateMachines.get(C.ATTACK):case this.stateMachines.get(C.TURNLEFT):case this.stateMachines.get(C.TURNRIGHT):case this.stateMachines.get(C.BLOCKTURNLEFT):case this.stateMachines.get(C.BLOCKTURNRIGHT):case this.stateMachines.get(C.BLOCKFRONT):case this.stateMachines.get(C.BLOCKBACK):case this.stateMachines.get(C.BLOCKLEFT):case this.stateMachines.get(C.BLOCKRIGHT):case this.stateMachines.get(C.DEATH):case this.stateMachines.get(C.AIRDEATH):this.params.get(C.DEATH).value?this.currentState=this.stateMachines.get(C.DEATH):this.params.get(C.AIRDEATH).value?this.currentState=this.stateMachines.get(C.AIRDEATH):this.params.get(C.TURNLEFT).value?this.currentState=this.stateMachines.get(C.TURNLEFT):this.params.get(C.TURNRIGHT).value?this.currentState=this.stateMachines.get(C.TURNRIGHT):this.params.get(C.BLOCKFRONT).value?this.currentState=this.stateMachines.get(C.BLOCKFRONT):this.params.get(C.BLOCKBACK).value?this.currentState=this.stateMachines.get(C.BLOCKBACK):this.params.get(C.BLOCKLEFT).value?this.currentState=this.stateMachines.get(C.BLOCKLEFT):this.params.get(C.BLOCKRIGHT).value?this.currentState=this.stateMachines.get(C.BLOCKRIGHT):this.params.get(C.BLOCKTURNLEFT).value?this.currentState=this.stateMachines.get(C.BLOCKTURNLEFT):this.params.get(C.BLOCKTURNRIGHT).value?this.currentState=this.stateMachines.get(C.BLOCKTURNRIGHT):this.params.get(C.ATTACK).value?this.currentState=this.stateMachines.get(C.ATTACK):this.params.get(C.IDLE).value?this.currentState=this.stateMachines.get(C.IDLE):this.currentState=this.currentState;break;default:this.currentState=this.stateMachines.get(C.IDLE)}},n}(st))||jt);p._RF.pop(),p._RF.push({},"d061bV0s7dMvL4lQmXdfLpY","PlayerManager",void 0);var ne,ie=(0,f.ccclass)("PlayerManager")($t=function(s){function o(){for(var t,i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return t=s.call.apply(s,[this].concat(a))||this,e(n(t),"speed",.1),e(n(t),"targetX",void 0),e(n(t),"targetY",void 0),e(n(t),"isMoving",!1),t}t(o,s);var h=o.prototype;return h.init=function(){var t=i((function*(t){this.fsm=this.addComponent(ee),yield this.fsm.init(),s.prototype.init.call(this,t),this.targetX=this.x,this.targetY=this.y,a.Instance.on(F.PLAYER_CTRL,this.inputProcess,this),a.Instance.on(F.ATTACK_PLAYER,this.onDead,this)}));return function(e){return t.apply(this,arguments)}}(),h.onDestroy=function(){s.prototype.onDestroy.call(this),a.Instance.off(F.PLAYER_CTRL,this.inputProcess),a.Instance.off(F.ATTACK_PLAYER,this.onDead)},h.update=function(){this.updateXY(),s.prototype.update.call(this)},h.updateXY=function(){this.targetX<this.x?this.x-=this.speed:this.targetX>this.x&&(this.x+=this.speed),this.targetY<this.y?this.y-=this.speed:this.targetY>this.y&&(this.y+=this.speed),Math.abs(this.targetX-this.x)<.01&&Math.abs(this.targetY-this.y)<.01&&this.isMoving&&(this.x=this.targetX,this.y=this.targetY,this.isMoving=!1,a.Instance.emit(F.PLAYER_MOVE_END))},h.onDead=function(t){this.state=t},h.onAttackShake=function(t){a.Instance.emit(F.SCREEN_SHAKE,t)},h.inputProcess=function(t){if(!this.isMoving&&this.state!==_.DEATH&&this.state!==_.AIRDEATH&&this.state!==_.ATTACK){var e=this.willAttack(t);if(e)return a.Instance.emit(F.RECORD_STEP),this.state=_.ATTACK,a.Instance.emit(F.ATTACK_ENEMY,e),a.Instance.emit(F.PLAYER_MOVE_END),void a.Instance.emit(F.DOOR_OPEN);this.willBlock(t)?t===P.TOP?a.Instance.emit(F.SCREEN_SHAKE,H.TOP):t===P.BOTTOM?a.Instance.emit(F.SCREEN_SHAKE,H.BOTTOM):t===P.LEFT?a.Instance.emit(F.SCREEN_SHAKE,H.LEFT):t===P.RIGHT?a.Instance.emit(F.SCREEN_SHAKE,H.RIGHT):t===P.TURNLEFT&&this.direction===K.TOP?a.Instance.emit(F.SCREEN_SHAKE,H.LEFT):t===P.TURNLEFT&&this.direction===K.LEFT?a.Instance.emit(F.SCREEN_SHAKE,H.BOTTOM):t===P.TURNLEFT&&this.direction===K.BOTTOM?a.Instance.emit(F.SCREEN_SHAKE,H.RIGHT):t===P.TURNLEFT&&this.direction===K.RIGHT?a.Instance.emit(F.SCREEN_SHAKE,H.TOP):t===P.TURNRIGHT&&this.direction===K.TOP?a.Instance.emit(F.SCREEN_SHAKE,H.RIGHT):t===P.TURNRIGHT&&this.direction===K.LEFT?a.Instance.emit(F.SCREEN_SHAKE,H.TOP):t===P.TURNRIGHT&&this.direction===K.BOTTOM?a.Instance.emit(F.SCREEN_SHAKE,H.LEFT):t===P.TURNRIGHT&&this.direction===K.RIGHT&&a.Instance.emit(F.SCREEN_SHAKE,H.BOTTOM):this.move(t)}},h.move=function(t){a.Instance.emit(F.RECORD_STEP),t===P.TOP?(this.targetY-=1,this.isMoving=!0,this.showSmoke(K.TOP)):t===P.BOTTOM?(this.targetY+=1,this.isMoving=!0,this.showSmoke(K.BOTTOM)):t===P.LEFT?(this.targetX-=1,this.isMoving=!0,this.showSmoke(K.LEFT)):t===P.RIGHT?(this.targetX+=1,this.isMoving=!0,this.showSmoke(K.RIGHT)):t===P.TURNLEFT?(this.direction===K.TOP?this.direction=K.LEFT:this.direction===K.BOTTOM?this.direction=K.RIGHT:this.direction===K.LEFT?this.direction=K.BOTTOM:this.direction===K.RIGHT&&(this.direction=K.TOP),this.state=_.TURNLEFT,a.Instance.emit(F.PLAYER_MOVE_END)):t===P.TURNRIGHT&&(this.direction===K.TOP?this.direction=K.RIGHT:this.direction===K.BOTTOM?this.direction=K.LEFT:this.direction===K.LEFT?this.direction=K.TOP:this.direction===K.RIGHT&&(this.direction=K.BOTTOM),this.state=_.TURNRIGHT,a.Instance.emit(F.PLAYER_MOVE_END))},h.showSmoke=function(t){a.Instance.emit(F.SHOW_SMOKE,this.x,this.y,t)},h.willAttack=function(t){for(var e=r.Instance.enemies.filter((function(t){return t.state!==_.DEATH})),n=0;n<e.length;n++){var i=e[n],s=i.x,a=i.y,o=i.id;if(this.direction===K.TOP&&t===P.TOP&&a===this.targetY-2&&s===this.x)return o;if(this.direction===K.BOTTOM&&t===P.BOTTOM&&a===this.targetY+2&&s===this.x)return o;if(this.direction===K.LEFT&&t===P.LEFT&&s===this.targetX-2&&a===this.y)return o;if(this.direction===K.RIGHT&&t===P.RIGHT&&s===this.targetX+2&&a===this.y)return o}return""},h.willBlock=function(t){var e=this.targetX,n=this.targetY,i=this.direction,s=r.Instance.tileInfo,a=r.Instance.enemies.filter((function(t){return t.state!==_.DEATH})),o=r.Instance.door||{},h=o.x,c=o.y,u=o.state,l=r.Instance.bursts.filter((function(t){return t.state!==_.DEATH})),p=r.Instance,f=p.mapRowCount,T=p.mapColumnCount;if(t===P.TOP){var d=n-1;if(i===K.TOP){var v,E;if(d<0)return this.state=_.BLOCKFRONT,!0;var m=n-2,M=null===(v=s[e])||void 0===v?void 0:v[d],I=null===(E=s[e])||void 0===E?void 0:E[m];if((h===e&&c===d||h===e&&c===m)&&u!==_.DEATH)return this.state=_.BLOCKFRONT,!0;for(var R=0;R<a.length;R++){var O=a[R],L=O.x,y=O.y;if(L===e&&y===m||L===e&&y===d)return this.state=_.BLOCKFRONT,!0}if(l.some((function(t){return t.x===e&&t.y===d}))&&(!I||I.turnable))return!1;if(!M||!M.moveable||I&&!I.turnable)return this.state=_.BLOCKFRONT,!0}else if(i===K.BOTTOM){var S,g;if(d<0)return this.state=_.BLOCKBACK,!0;var C=n,A=null===(S=s[e])||void 0===S?void 0:S[d],F=null===(g=s[e])||void 0===g?void 0:g[C];if((h===e&&c===d||h===e&&c===C)&&u!==_.DEATH)return this.state=_.BLOCKBACK,!0;for(var B=0;B<a.length;B++){var D=a[B],H=D.x,w=D.y;if(H===e&&w===d)return this.state=_.BLOCKBACK,!0}if(l.some((function(t){return t.x===e&&t.y===d}))&&(!F||F.turnable))return!1;if(!A||!A.moveable||F&&!F.turnable)return this.state=_.BLOCKBACK,!0}else if(i===K.LEFT){var b,N;if(d<0)return this.state=_.BLOCKRIGHT,!0;var k=e-1,x=n-1,G=null===(b=s[e])||void 0===b?void 0:b[d],U=null===(N=s[k])||void 0===N?void 0:N[x];if((h===e&&c===d||h===k&&c===x)&&u!==_.DEATH)return this.state=_.BLOCKRIGHT,!0;for(var W=0;W<a.length;W++){var Y=a[W],V=Y.x,X=Y.y;if(V===e&&X===d||V===k&&X===x)return this.state=_.BLOCKRIGHT,!0}if(l.some((function(t){return t.x===e&&t.y===d}))&&(!U||U.turnable))return!1;if(!G||!G.moveable||U&&!U.turnable)return this.state=_.BLOCKRIGHT,!0}else if(i===K.RIGHT){var Z,z;if(d<0)return this.state=_.BLOCKLEFT,!0;var q=e+1,j=n-1,J=null===(Z=s[e])||void 0===Z?void 0:Z[d],Q=null===(z=s[q])||void 0===z?void 0:z[j];if((h===e&&c===d||h===q&&c===j)&&u!==_.DEATH)return this.state=_.BLOCKLEFT,!0;for(var $=0;$<a.length;$++){var tt=a[$],et=tt.x,nt=tt.y;if(et===e&&nt===d||et===q&&nt===j)return this.state=_.BLOCKLEFT,!0}if(l.some((function(t){return t.x===e&&t.y===d}))&&(!Q||Q.turnable))return!1;if(!J||!J.moveable||Q&&!Q.turnable)return this.state=_.BLOCKLEFT,!0}}else if(t===P.BOTTOM){var it=n+1;if(i===K.TOP){var st,at;if(it>T-1)return this.state=_.BLOCKBACK,!0;var rt=n,ot=null===(st=s[e])||void 0===st?void 0:st[it],ht=null===(at=s[e])||void 0===at?void 0:at[rt];if((h===e&&c===it||h===e&&c===rt)&&u!==_.DEATH)return this.state=_.BLOCKBACK,!0;for(var ct=0;ct<a.length;ct++){var ut=a[ct],lt=ut.x,pt=ut.y;if(lt===e&&pt===it)return this.state=_.BLOCKBACK,!0}if(l.some((function(t){return t.x===e&&t.y===it}))&&(!ht||ht.turnable))return!1;if(!ot||!ot.moveable||ht&&!ht.turnable)return this.state=_.BLOCKBACK,!0}else if(i===K.BOTTOM){var ft,Tt;if(it>T-1)return this.state=_.BLOCKFRONT,!0;var dt=n+2,vt=null===(ft=s[e])||void 0===ft?void 0:ft[it],Et=null===(Tt=s[e])||void 0===Tt?void 0:Tt[dt];if((h===e&&c===it||h===e&&c===dt)&&u!==_.DEATH)return this.state=_.BLOCKFRONT,!0;for(var mt=0;mt<a.length;mt++){var Mt=a[mt],It=Mt.x,Rt=Mt.y;if(It===e&&Rt===dt||It===e&&Rt===it)return this.state=_.BLOCKFRONT,!0}if(l.some((function(t){return t.x===e&&t.y===it}))&&(!Et||Et.turnable))return!1;if(!vt||!vt.moveable||Et&&!Et.turnable)return this.state=_.BLOCKFRONT,!0}else if(i===K.LEFT){var Ot,Lt;if(it>T-1)return this.state=_.BLOCKLEFT,!0;var yt=e-1,St=n+1,gt=null===(Ot=s[e])||void 0===Ot?void 0:Ot[it],Ct=null===(Lt=s[yt])||void 0===Lt?void 0:Lt[St];if((h===e&&c===it||h===yt&&c===St)&&u!==_.DEATH)return this.state=_.BLOCKLEFT,!0;for(var At=0;At<a.length;At++){var Ft=a[At],_t=Ft.x,Kt=Ft.y;if(_t===e&&Kt===it||_t===yt&&Kt===St)return this.state=_.BLOCKLEFT,!0}if(l.some((function(t){return t.x===e&&t.y===it}))&&(!Ct||Ct.turnable))return!1;if(!gt||!gt.moveable||Ct&&!Ct.turnable)return this.state=_.BLOCKLEFT,!0}else if(i===K.RIGHT){var Bt,Dt;if(it>T-1)return this.state=_.BLOCKRIGHT,!0;var Ht=e+1,Pt=n+1,wt=null===(Bt=s[e])||void 0===Bt?void 0:Bt[it],bt=null===(Dt=s[Ht])||void 0===Dt?void 0:Dt[Pt];if((h===e&&c===it||h===Ht&&c===Pt)&&u!==_.DEATH)return this.state=_.BLOCKRIGHT,!0;for(var Nt=0;Nt<a.length;Nt++){var kt=a[Nt],xt=kt.x,Gt=kt.y;if(xt===e&&Gt===it||xt===Ht&&Gt===Pt)return this.state=_.BLOCKRIGHT,!0}if(l.some((function(t){return t.x===e&&t.y===it}))&&(!bt||bt.turnable))return!1;if(!wt||!wt.moveable||bt&&!bt.turnable)return this.state=_.BLOCKRIGHT,!0}}else if(t===P.LEFT){var Ut=e-1;if(i===K.TOP){var Wt,Yt;if(Ut<0)return this.state=_.BLOCKLEFT,!0;var Vt=e-1,Xt=n-1,Zt=null===(Wt=s[Ut])||void 0===Wt?void 0:Wt[n],zt=null===(Yt=s[Vt])||void 0===Yt?void 0:Yt[Xt];if((h===Ut&&c===n||h===Vt&&c===Xt)&&u!==_.DEATH)return this.state=_.BLOCKLEFT,!0;for(var qt=0;qt<a.length;qt++){var jt=a[qt],Jt=jt.x,Qt=jt.y;if(Jt===Ut&&Qt===n||Jt===Vt&&Qt===Xt)return this.state=_.BLOCKLEFT,!0}if(l.some((function(t){return t.x===Ut&&t.y===n}))&&(!zt||zt.turnable))return!1;if(!Zt||!Zt.moveable||zt&&!zt.turnable)return this.state=_.BLOCKLEFT,!0}else if(i===K.BOTTOM){var $t,te;if(Ut<0)return this.state=_.BLOCKRIGHT,!0;var ee=e-1,ne=n+1,ie=null===($t=s[Ut])||void 0===$t?void 0:$t[n],se=null===(te=s[ee])||void 0===te?void 0:te[ne];if((h===Ut&&c===n||h===ee&&c===ne)&&u!==_.DEATH)return this.state=_.BLOCKRIGHT,!0;for(var ae=0;ae<a.length;ae++){var re=a[ae],oe=re.x,he=re.y;if(oe===Ut&&he===n||oe===ee&&he===ne)return this.state=_.BLOCKRIGHT,!0}if(l.some((function(t){return t.x===Ut&&t.y===n}))&&(!se||se.turnable))return!1;if(!ie||!ie.moveable||se&&!se.turnable)return this.state=_.BLOCKRIGHT,!0}else if(i===K.LEFT){var ce,ue;if(Ut<0)return this.state=_.BLOCKFRONT,!0;var le=e-2,pe=null===(ce=s[Ut])||void 0===ce?void 0:ce[n],fe=null===(ue=s[le])||void 0===ue?void 0:ue[n];if((h===Ut&&c===n||h===le&&c===n)&&u!==_.DEATH)return this.state=_.BLOCKFRONT,!0;for(var Te=0;Te<a.length;Te++){var de=a[Te],ve=de.x,Ee=de.y;if(ve===Ut&&Ee===n||ve===le&&Ee===n)return this.state=_.BLOCKFRONT,!0}if(l.some((function(t){return t.x===Ut&&t.y===n}))&&(!fe||fe.turnable))return!1;if(!pe||!pe.moveable||fe&&!fe.turnable)return this.state=_.BLOCKFRONT,!0}else if(i===K.RIGHT){var me,Me;if(Ut<0)return this.state=_.BLOCKBACK,!0;var Ie=e,Re=null===(me=s[Ut])||void 0===me?void 0:me[n],Oe=null===(Me=s[Ie])||void 0===Me?void 0:Me[n];if((h===Ut&&c===n||h===Ie&&c===n)&&u!==_.DEATH)return this.state=_.BLOCKBACK,!0;for(var Le=0;Le<a.length;Le++){var ye=a[Le],Se=ye.x,ge=ye.y;if(Se===Ut&&ge===n)return this.state=_.BLOCKBACK,!0}if(l.some((function(t){return t.x===Ut&&t.y===n}))&&(!Oe||Oe.turnable))return!1;if(!Re||!Re.moveable||Oe&&!Oe.turnable)return this.state=_.BLOCKBACK,!0}}else if(t===P.RIGHT){var Ce=e+1;if(i===K.TOP){var Ae,Fe;if(Ce>f-1)return this.state=_.BLOCKRIGHT,!0;var _e=e+1,Ke=n-1,Be=null===(Ae=s[Ce])||void 0===Ae?void 0:Ae[n],De=null===(Fe=s[_e])||void 0===Fe?void 0:Fe[Ke];if((h===Ce&&c===n||h===_e&&c===Ke)&&u!==_.DEATH)return this.state=_.BLOCKRIGHT,!0;for(var He=0;He<a.length;He++){var Pe=a[He],we=Pe.x,be=Pe.y;if(we===Ce&&be===n||we===_e&&be===Ke)return this.state=_.BLOCKRIGHT,!0}if(l.some((function(t){return t.x===Ce&&t.y===n}))&&(!De||De.turnable))return!1;if(!Be||!Be.moveable||De&&!De.turnable)return this.state=_.BLOCKRIGHT,!0}else if(i===K.BOTTOM){var Ne,ke;if(Ce>f-1)return this.state=_.BLOCKLEFT,!0;var xe=e+1,Ge=n+1,Ue=null===(Ne=s[Ce])||void 0===Ne?void 0:Ne[n],We=null===(ke=s[xe])||void 0===ke?void 0:ke[Ge];if((h===Ce&&c===n||h===xe&&c===Ge)&&u!==_.DEATH)return this.state=_.BLOCKLEFT,!0;for(var Ye=0;Ye<a.length;Ye++){var Ve=a[Ye],Xe=Ve.x,Ze=Ve.y;if(Xe===Ce&&Ze===n||Xe===xe&&Ze===Ge)return this.state=_.BLOCKLEFT,!0}if(l.some((function(t){return t.x===Ce&&t.y===n}))&&(!We||We.turnable))return!1;if(!Ue||!Ue.moveable||We&&!We.turnable)return this.state=_.BLOCKLEFT,!0}else if(i===K.LEFT){var ze,qe;if(Ce>f-1)return this.state=_.BLOCKBACK,!0;var je=e,Je=null===(ze=s[Ce])||void 0===ze?void 0:ze[n],Qe=null===(qe=s[je])||void 0===qe?void 0:qe[n];if((h===Ce&&c===n||h===je&&c===n)&&u!==_.DEATH)return this.state=_.BLOCKBACK,!0;for(var $e=0;$e<a.length;$e++){var tn=a[$e],en=tn.x,nn=tn.y;if(en===Ce&&nn===n)return this.state=_.BLOCKBACK,!0}if(l.some((function(t){return t.x===Ce&&t.y===n}))&&(!Qe||Qe.turnable))return!1;if(!Je||!Je.moveable||Qe&&!Qe.turnable)return this.state=_.BLOCKBACK,!0}else if(i===K.RIGHT){var sn,an;if(Ce>f-1)return this.state=_.BLOCKFRONT,!0;var rn=e+2,on=null===(sn=s[Ce])||void 0===sn?void 0:sn[n],hn=null===(an=s[rn])||void 0===an?void 0:an[n];if((h===Ce&&c===n||h===rn&&c===n)&&u!==_.DEATH)return this.state=_.BLOCKFRONT,!0;for(var cn=0;cn<a.length;cn++){var un=a[cn],ln=un.x,pn=un.y;if(ln===Ce&&pn===n||ln===rn&&pn===n)return this.state=_.BLOCKFRONT,!0}if(l.some((function(t){return t.x===Ce&&t.y===n}))&&(!hn||hn.turnable))return!1;if(!on||!on.moveable||hn&&!hn.turnable)return this.state=_.BLOCKFRONT,!0}}else if(t===P.TURNLEFT){var fn,Tn,dn,vn,En,mn,Mn,In;if(i===K.TOP?(Mn=n-1,In=e-1):i===K.BOTTOM?(Mn=n+1,In=e+1):i===K.LEFT?(Mn=n+1,In=e-1):i===K.RIGHT&&(Mn=n-1,In=e+1),(h===e&&c===Mn||h===In&&c===n||h===In&&c===Mn)&&u!==_.DEATH)return this.state=_.BLOCKTURNLEFT,!0;for(var Rn=0;Rn<a.length;Rn++){var On=a[Rn],Ln=On.x,yn=On.y;if(Ln===In&&yn===n)return this.state=_.BLOCKTURNLEFT,!0;if(Ln===In&&yn===Mn)return this.state=_.BLOCKTURNLEFT,!0;if(Ln===e&&yn===Mn)return this.state=_.BLOCKTURNLEFT,!0}if((null===(fn=s[e])||void 0===fn?void 0:fn[Mn])&&!(null===(Tn=s[e])||void 0===Tn?void 0:Tn[Mn].turnable)||(null===(dn=s[In])||void 0===dn?void 0:dn[n])&&!(null===(vn=s[In])||void 0===vn?void 0:vn[n].turnable)||(null===(En=s[In])||void 0===En?void 0:En[Mn])&&!(null===(mn=s[In])||void 0===mn?void 0:mn[Mn].turnable))return this.state=_.BLOCKTURNLEFT,!0}else if(t===P.TURNRIGHT){var Sn,gn,Cn,An,Fn,_n,Kn,Bn;if(i===K.TOP?(Bn=n-1,Kn=e+1):i===K.BOTTOM?(Bn=n+1,Kn=e-1):i===K.LEFT?(Bn=n-1,Kn=e-1):i===K.RIGHT&&(Bn=n+1,Kn=e+1),(h===e&&c===Bn||h===Kn&&c===n||h===Kn&&c===Bn)&&u!==_.DEATH)return this.state=_.BLOCKTURNRIGHT,!0;for(var Dn=0;Dn<a.length;Dn++){var Hn=a[Dn],Pn=Hn.x,wn=Hn.y;if(Pn===Kn&&wn===n)return this.state=_.BLOCKTURNRIGHT,!0;if(Pn===Kn&&wn===Bn)return this.state=_.BLOCKTURNRIGHT,!0;if(Pn===e&&wn===Bn)return this.state=_.BLOCKTURNRIGHT,!0}if((null===(Sn=s[e])||void 0===Sn?void 0:Sn[Bn])&&!(null===(gn=s[e])||void 0===gn?void 0:gn[Bn].turnable)||(null===(Cn=s[Kn])||void 0===Cn?void 0:Cn[n])&&!(null===(An=s[Kn])||void 0===An?void 0:An[n].turnable)||(null===(Fn=s[Kn])||void 0===Fn?void 0:Fn[Bn])&&!(null===(_n=s[Kn])||void 0===_n?void 0:_n[Bn].turnable))return this.state=_.BLOCKTURNRIGHT,!0}return!1},o}(Q))||$t;p._RF.pop(),p._RF.push({},"f9917jX+zdHIbvW8s3LWI1Z","TileMapManager",void 0);var se=(0,f.ccclass)("TileMapManager")(ne=function(e){function n(){return e.apply(this,arguments)||this}return t(n,e),n.prototype.init=function(){var t=i((function*(){var t=this,e=r.Instance.mapInfo;r.Instance.tileInfo=[];for(var n=yield h.Instance.loadDir("texture/tile/tile/"),i=0;i<e.length;i++){var s=e[i];r.Instance.tileInfo[i]=[];for(var a=function(e){var a=s[e];if(null===a.src||null===a.type)return"continue";var o=a.src;(1===o&&i%2==0&&e%2==1||5===o&&i%2==0&&e%2==1||9===o&&i%2==0&&e%2==1)&&(o+=U(0,4));var h="tile ("+o+")",c=n.find((function(t){return t.name===h}))||n[0],u=a.type,l=W(),p=l.addComponent(j);p.init(u,c,i,e),l.setParent(t.node),r.Instance.tileInfo[i][e]=p},o=0;o<s.length;o++)a(o)}}));return function(){return t.apply(this,arguments)}}(),n}(T))||ne;p._RF.pop(),p._RF.push({},"241ddE/sV5ESagkkGGHgmSq","DeathSubStateMachine",void 0);var ae="texture/door/death",re=function(e){function n(t){var n;return(n=e.call(this,t)||this).stateMachines.set(K.TOP,new ht(t,""+ae)),n.stateMachines.set(K.BOTTOM,new ht(t,""+ae)),n.stateMachines.set(K.LEFT,new ht(t,""+ae)),n.stateMachines.set(K.RIGHT,new ht(t,""+ae)),n}return t(n,e),n}(rt);p._RF.pop(),p._RF.push({},"cbd34mDWIlKzpdLYgdIHQFe","IdleSubStateMachine",void 0);var oe,he="texture/door/idle",ce=function(e){function n(t){var n;return(n=e.call(this,t)||this).stateMachines.set(K.TOP,new ht(t,he+"/top")),n.stateMachines.set(K.BOTTOM,new ht(t,he+"/top")),n.stateMachines.set(K.LEFT,new ht(t,he+"/left")),n.stateMachines.set(K.RIGHT,new ht(t,he+"/left")),n}return t(n,e),n}(rt);p._RF.pop(),p._RF.push({},"affe7BshsJIJJp5jesrLCoH","DoorStateMachine",void 0);var ue,le=(0,f.ccclass)("DoorStateMachine")(oe=function(e){function n(){return e.apply(this,arguments)||this}t(n,e);var s=n.prototype;return s.init=function(){var t=i((function*(){this.animationComponent=this.node.addComponent(I),this.initParams(),this.initStateMachines(),this.initAnimationEvent(),yield Promise.all(this.waitingList)}));return function(){return t.apply(this,arguments)}}(),s.initAnimationEvent=function(){},s.initParams=function(){this.params.set(C.IDLE,nt()),this.params.set(C.DEATH,nt()),this.params.set(C.DIRECTION,it())},s.initStateMachines=function(){this.stateMachines.set(C.IDLE,new ce(this)),this.stateMachines.set(C.DEATH,new re(this))},s.run=function(){switch(this.currentState){case this.stateMachines.get(C.IDLE):case this.stateMachines.get(C.DEATH):this.params.get(C.DEATH).value?this.currentState=this.stateMachines.get(C.DEATH):this.params.get(C.IDLE).value?this.currentState=this.stateMachines.get(C.IDLE):this.currentState=this.currentState;break;default:this.currentState=this.stateMachines.get(C.IDLE)}},n}(st))||oe;p._RF.pop(),p._RF.push({},"85323nSpM5Cx4bEz6w7N8L7","DoorManager",void 0);var pe,fe=(0,f.ccclass)("DoorManager")(ue=function(e){function n(){return e.apply(this,arguments)||this}t(n,e);var s=n.prototype;return s.init=function(){var t=i((function*(t){this.fsm=this.addComponent(le),yield this.fsm.init(),e.prototype.init.call(this,t),a.Instance.on(F.DOOR_OPEN,this.onOpen,this)}));return function(e){return t.apply(this,arguments)}}(),s.onDestroy=function(){e.prototype.onDestroy.call(this),a.Instance.off(F.DOOR_OPEN,this.onOpen)},s.onOpen=function(){r.Instance.enemies.every((function(t){return t.state===_.DEATH}))&&this.state!==_.DEATH&&(this.state=_.DEATH)},n}(Q))||ue;p._RF.pop(),p._RF.push({},"3c046oDyAtHFKR0Y1cdWBz3","BurstStateMachine",void 0);var Te,de=f.ccclass,ve="texture/burst",Ee=de("BurstStateMachine")(pe=function(e){function n(){return e.apply(this,arguments)||this}t(n,e);var s=n.prototype;return s.init=function(){var t=i((function*(){this.animationComponent=this.node.addComponent(I),this.initParams(),this.initStateMachines(),this.initAnimationEvent(),yield Promise.all(this.waitingList)}));return function(){return t.apply(this,arguments)}}(),s.initAnimationEvent=function(){},s.initParams=function(){this.params.set(C.IDLE,nt()),this.params.set(C.ATTACK,nt()),this.params.set(C.DEATH,nt()),this.params.set(C.DIRECTION,it())},s.initStateMachines=function(){this.stateMachines.set(C.IDLE,new ht(this,ve+"/idle")),this.stateMachines.set(C.ATTACK,new ht(this,ve+"/attack")),this.stateMachines.set(C.DEATH,new ht(this,ve+"/death"))},s.run=function(){switch(this.currentState){case this.stateMachines.get(C.IDLE):case this.stateMachines.get(C.ATTACK):case this.stateMachines.get(C.DEATH):this.params.get(C.DEATH).value?this.currentState=this.stateMachines.get(C.DEATH):this.params.get(C.ATTACK).value?this.currentState=this.stateMachines.get(C.ATTACK):this.params.get(C.IDLE).value?this.currentState=this.stateMachines.get(C.IDLE):this.currentState=this.currentState;break;default:this.currentState=this.stateMachines.get(C.IDLE)}},n}(st))||pe;p._RF.pop(),p._RF.push({},"9bc2amc2ixEialGuyRG6zPa","BurstManager",void 0);var me=(0,f.ccclass)("BurstManager")(Te=function(e){function n(){return e.apply(this,arguments)||this}t(n,e);var s=n.prototype;return s.init=function(){var t=i((function*(t){this.fsm=this.addComponent(Ee),yield this.fsm.init(),e.prototype.init.call(this,t),this.transform=this.getComponent(d),this.transform.setContentSize(z,q),a.Instance.on(F.PLAYER_MOVE_END,this.onBurst,this)}));return function(e){return t.apply(this,arguments)}}(),s.onDestroy=function(){e.prototype.onDestroy.call(this),a.Instance.off(F.PLAYER_MOVE_END,this.onBurst)},s.update=function(){this.node.setPosition(this.x*z,-this.y*q)},s.onBurst=function(){if(this.state!==_.DEATH){var t=r.Instance.player,e=t.targetX,n=t.targetY;this.x===e&&this.y===n&&this.state===_.IDLE?this.state=_.ATTACK:this.state===_.ATTACK&&(this.state=_.DEATH,a.Instance.emit(F.SCREEN_SHAKE,H.BOTTOM),this.x===e&&this.y===n&&a.Instance.emit(F.ATTACK_PLAYER,_.AIRDEATH))}},n}(Q))||Te;p._RF.pop(),p._RF.push({},"1a656Wl6thKsaHfvJNDKrED","SpikesFourSubStateMachine",void 0);var Me="texture/spikes/spikesfour",Ie=function(e){function n(t){var n;return(n=e.call(this,t)||this).stateMachines.set(w.ZERO,new ht(t,Me+"/zero")),n.stateMachines.set(w.ONE,new ht(t,Me+"/one")),n.stateMachines.set(w.TWO,new ht(t,Me+"/two")),n.stateMachines.set(w.THREE,new ht(t,Me+"/three")),n.stateMachines.set(w.FOUR,new ht(t,Me+"/four")),n.stateMachines.set(w.FIVE,new ht(t,Me+"/five")),n}return t(n,e),n}(Et);p._RF.pop(),p._RF.push({},"81558fwqMVG7YVpFd1tj//7","SpikesOneSubStateMachine",void 0);var Re="texture/spikes/spikesone",Oe=function(e){function n(t){var n;return(n=e.call(this,t)||this).stateMachines.set(w.ZERO,new ht(t,Re+"/zero")),n.stateMachines.set(w.ONE,new ht(t,Re+"/one")),n.stateMachines.set(w.TWO,new ht(t,Re+"/two")),n}return t(n,e),n}(Et);p._RF.pop(),p._RF.push({},"c46f8exu2RF8qwIi04u5ENM","SpikesThreeSubStateMachine",void 0);var Le="texture/spikes/spikesthree",ye=function(e){function n(t){var n;return(n=e.call(this,t)||this).stateMachines.set(w.ZERO,new ht(t,Le+"/zero")),n.stateMachines.set(w.ONE,new ht(t,Le+"/one")),n.stateMachines.set(w.TWO,new ht(t,Le+"/two")),n.stateMachines.set(w.THREE,new ht(t,Le+"/three")),n.stateMachines.set(w.FOUR,new ht(t,Le+"/four")),n}return t(n,e),n}(Et);p._RF.pop(),p._RF.push({},"57709XdX1tDnobcQimju197","SpikesTwoSubStateMachine",void 0);var Se,ge="texture/spikes/spikestwo",Ce=function(e){function n(t){var n;return(n=e.call(this,t)||this).stateMachines.set(w.ZERO,new ht(t,ge+"/zero")),n.stateMachines.set(w.ONE,new ht(t,ge+"/one")),n.stateMachines.set(w.TWO,new ht(t,ge+"/two")),n.stateMachines.set(w.THREE,new ht(t,ge+"/three")),n}return t(n,e),n}(Et);p._RF.pop(),p._RF.push({},"f41d5wj7o9DuJfAZ4w7iIfV","SpikesStateMachine",void 0);var Ae,Fe=(0,f.ccclass)("SpikesStateMachine")(Se=function(e){function n(){return e.apply(this,arguments)||this}t(n,e);var s=n.prototype;return s.init=function(){var t=i((function*(){this.animationComponent=this.node.addComponent(I),this.initParams(),this.initStateMachines(),this.initAnimationEvent(),yield Promise.all(this.waitingList)}));return function(){return t.apply(this,arguments)}}(),s.initAnimationEvent=function(){var t=this;this.animationComponent.on(I.EventType.FINISHED,(function(){var e=t.animationComponent.defaultClip.name,n=t.params.get(C.SPIKES_TOTAL_COUNT).value;(n===b.SPIKES_ONE&&e.includes("spikesone/two")||n===b.SPIKES_TWO&&e.includes("spikestwo/three")||n===b.SPIKES_THREE&&e.includes("spikesthree/four")||n===b.SPIKES_FOUR&&e.includes("spikesfour/five"))&&t.node.getComponent(_e).backZero()}))},s.initParams=function(){this.params.set(C.SPIKES_TOTAL_COUNT,it()),this.params.set(C.SPIKES_CUR_COUNT,it())},s.initStateMachines=function(){this.stateMachines.set(N.SPIKES_ONE,new Oe(this)),this.stateMachines.set(N.SPIKES_TWO,new Ce(this)),this.stateMachines.set(N.SPIKES_THREE,new ye(this)),this.stateMachines.set(N.SPIKES_FOUR,new Ie(this))},s.run=function(){var t=this.params.get(C.SPIKES_TOTAL_COUNT).value;switch(this.currentState){case this.stateMachines.get(N.SPIKES_ONE):case this.stateMachines.get(N.SPIKES_TWO):case this.stateMachines.get(N.SPIKES_THREE):case this.stateMachines.get(N.SPIKES_FOUR):t===b.SPIKES_ONE?this.currentState=this.stateMachines.get(N.SPIKES_ONE):t===b.SPIKES_TWO?this.currentState=this.stateMachines.get(N.SPIKES_TWO):t===b.SPIKES_THREE?this.currentState=this.stateMachines.get(N.SPIKES_THREE):t===b.SPIKES_FOUR?this.currentState=this.stateMachines.get(N.SPIKES_FOUR):this.currentState=this.currentState;break;default:this.currentState=this.stateMachines.get(N.SPIKES_ONE)}},n}(st))||Se;p._RF.pop(),p._RF.push({},"3f0fdrnHy5NaYg+CgvL6nX7","SpikesManager",void 0);var _e=(0,f.ccclass)("SpikesManager")(Ae=function(o){function h(){for(var t,i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];return t=o.call.apply(o,[this].concat(s))||this,e(n(t),"id",x(12)),e(n(t),"_totalCount",void 0),e(n(t),"_count",0),e(n(t),"x",void 0),e(n(t),"y",void 0),e(n(t),"type",void 0),e(n(t),"fsm",void 0),t}t(h,o);var c=h.prototype;return c.init=function(){var t=i((function*(t){this.node.addComponent(v).sizeMode=v.SizeMode.CUSTOM,this.getComponent(d).setContentSize(220,220),this.fsm=this.node.addComponent(Fe),yield this.fsm.init(),this.x=t.x,this.y=t.y;var e=t.type;this.totalCount=b[e],this.count=t.count,a.Instance.on(F.PLAYER_MOVE_END,this.onLoop,this)}));return function(e){return t.apply(this,arguments)}}(),c.onDestroy=function(){a.Instance.off(F.PLAYER_MOVE_END,this.onLoop)},c.update=function(){this.node.setPosition(this.x*z-82.5,-this.y*q+82.5)},c.onLoop=function(){this.count==this.totalCount?this.count=1:this.count++,this.onAttack()},c.backZero=function(){this.count=0},c.onAttack=function(){var t=r.Instance.player,e=t.x,n=t.y;e===this.x&&n===this.y&&this.count===this.totalCount&&a.Instance.emit(F.ATTACK_PLAYER,_.DEATH)},s(h,[{key:"count",get:function(){return this._count},set:function(t){this._count=t,this.fsm.setParams(C.SPIKES_CUR_COUNT,t)}},{key:"totalCount",get:function(){return this._totalCount},set:function(t){this._totalCount=t,this.fsm.setParams(C.SPIKES_TOTAL_COUNT,t)}}]),h}(T))||Ae;p._RF.pop(),p._RF.push({},"bd1a36HO0hEZYiCmbb4hdsS","DeathSubStateMachine",void 0);var Ke="texture/door/death",Be=function(e){function n(t){var n;return(n=e.call(this,t)||this).stateMachines.set(K.TOP,new ht(t,""+Ke)),n.stateMachines.set(K.BOTTOM,new ht(t,""+Ke)),n.stateMachines.set(K.LEFT,new ht(t,""+Ke)),n.stateMachines.set(K.RIGHT,new ht(t,""+Ke)),n}return t(n,e),n}(rt);p._RF.pop(),p._RF.push({},"f2860nev4VKObYhkfI39Vpv","IdleSubStateMachine",void 0);var De,He="texture/smoke/idle",Pe=function(e){function n(t){var n;return(n=e.call(this,t)||this).stateMachines.set(K.TOP,new ht(t,He+"/top",E.WrapMode.Normal,.08333333333333333)),n.stateMachines.set(K.BOTTOM,new ht(t,He+"/bottom",E.WrapMode.Normal,.08333333333333333)),n.stateMachines.set(K.LEFT,new ht(t,He+"/left",E.WrapMode.Normal,.08333333333333333)),n.stateMachines.set(K.RIGHT,new ht(t,He+"/right",E.WrapMode.Normal,.08333333333333333)),n}return t(n,e),n}(rt);p._RF.pop(),p._RF.push({},"1e09dbWc8NLMInVzRcnLZyh","SmokeStateMachine",void 0);var we,be=(0,f.ccclass)("SmokeStateMachine")(De=function(e){function n(){return e.apply(this,arguments)||this}t(n,e);var s=n.prototype;return s.init=function(){var t=i((function*(){this.animationComponent=this.node.addComponent(I),this.initParams(),this.initStateMachines(),this.initAnimationEvent(),yield Promise.all(this.waitingList)}));return function(){return t.apply(this,arguments)}}(),s.initAnimationEvent=function(){var t=this;this.animationComponent.on(I.EventType.FINISHED,(function(){var e=t.animationComponent.defaultClip.name;["idle"].some((function(t){return e.includes(t)}))&&(t.node.getComponent(Q).state=_.DEATH)}))},s.initParams=function(){this.params.set(C.IDLE,nt()),this.params.set(C.DEATH,nt()),this.params.set(C.DIRECTION,it())},s.initStateMachines=function(){this.stateMachines.set(C.IDLE,new Pe(this)),this.stateMachines.set(C.DEATH,new Be(this))},s.run=function(){switch(this.currentState){case this.stateMachines.get(C.DEATH):case this.stateMachines.get(C.IDLE):this.params.get(C.DEATH).value?this.currentState=this.stateMachines.get(C.DEATH):this.params.get(C.IDLE).value?this.currentState=this.stateMachines.get(C.IDLE):this.currentState=this.currentState;break;default:this.currentState=this.stateMachines.get(C.IDLE)}},n}(st))||De;p._RF.pop(),p._RF.push({},"5ee06kSeElMQa5ZUIpMP8kD","SmokeManager",void 0);var Ne,ke=(0,f.ccclass)("SmokeManager")(we=function(e){function n(){return e.apply(this,arguments)||this}return t(n,e),n.prototype.init=function(){var t=i((function*(t){this.fsm=this.addComponent(be),yield this.fsm.init(),e.prototype.init.call(this,t)}));return function(e){return t.apply(this,arguments)}}(),n}(Q))||we;p._RF.pop(),p._RF.push({},"ae2aewOHhpByp3eG8llF0Q9","ShakeManager",void 0);var xe,Ge,Ue=(0,f.ccclass)("ShakeManager")(Ne=function(i){function s(){for(var t,s=arguments.length,a=new Array(s),r=0;r<s;r++)a[r]=arguments[r];return t=i.call.apply(i,[this].concat(a))||this,e(n(t),"isShaking",void 0),e(n(t),"shakeType",void 0),e(n(t),"oldTime",void 0),e(n(t),"oldPos",{x:0,y:0}),t}t(s,i);var r=s.prototype;return r.onLoad=function(){a.Instance.on(F.SCREEN_SHAKE,this.onShake,this)},r.onDestroy=function(){a.Instance.off(F.SCREEN_SHAKE,this.onShake)},r.stop=function(){this.isShaking=!1},r.onShake=function(t){this.isShaking||(this.isShaking=!0,this.shakeType=t,this.oldTime=R.totalTime,this.oldPos.x=this.node.position.x,this.oldPos.y=this.node.position.y)},r.update=function(){this.onShakeUpdate()},r.onShakeUpdate=function(){if(this.isShaking){var t=(R.totalTime-this.oldTime)/1e3,e=1.6*Math.sin(12*Math.PI*t);this.shakeType===H.TOP?this.node.setPosition(this.oldPos.x,this.oldPos.y-e):this.shakeType===H.BOTTOM?this.node.setPosition(this.oldPos.x,this.oldPos.y+e):this.shakeType===H.LEFT?this.node.setPosition(this.oldPos.x-e,this.oldPos.y):this.shakeType===H.RIGHT&&this.node.setPosition(this.oldPos.x+e,this.oldPos.y),t>.2&&(this.isShaking=!1,this.node.setPosition(this.oldPos.x,this.oldPos.y))}},s}(T))||Ne;p._RF.pop(),p._RF.push({},"17d5aEnquFEpbWki0tR0Fap","BattleManager",void 0);var We=f.ccclass;(null===(xe=window)||void 0===xe?void 0:xe.vConsole)&&(window.vConsole.$dom.style.display="none");var Ye;We("BattleManager")(Ge=function(s){function o(){for(var t,i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return t=s.call.apply(s,[this].concat(a))||this,e(n(t),"level",void 0),e(n(t),"stage",null),e(n(t),"smokeLayer",null),e(n(t),"hasInited",!1),t}t(o,s);var h=o.prototype;return h.onLoad=function(){O.preloadScene(k.Start),r.Instance.levelIndex=1,a.Instance.on(F.RESTART_LEVEL,this.initLevel,this),a.Instance.on(F.NEXT_LEVEL,this.nextLevel,this),a.Instance.on(F.PLAYER_MOVE_END,this.checkArrived,this),a.Instance.on(F.SHOW_SMOKE,this.generateSmoke,this),a.Instance.on(F.RECORD_STEP,this.record,this),a.Instance.on(F.REVOKE_STEP,this.revoke,this),a.Instance.on(F.QUIT_BATTLE,this.quitBattle,this)},h.onDestroy=function(){a.Instance.off(F.RESTART_LEVEL,this.initLevel),a.Instance.off(F.NEXT_LEVEL,this.nextLevel),a.Instance.off(F.PLAYER_MOVE_END,this.checkArrived),a.Instance.off(F.SHOW_SMOKE,this.generateSmoke),a.Instance.off(F.RECORD_STEP,this.record),a.Instance.off(F.REVOKE_STEP,this.revoke),a.Instance.off(F.QUIT_BATTLE,this.quitBattle),a.Instance.clear()},h.start=function(){this.generateStage(),this.initLevel()},h.initLevel=function(){var t=i((function*(){var t,e=Y["level"+r.Instance.levelIndex];e?(this.hasInited?yield c.Instance.fadeIn():yield c.Instance.mask(),this.clearLevel(),this.level=e,r.Instance.mapInfo=this.level.mapInfo,r.Instance.mapRowCount=this.level.mapInfo.length||0,r.Instance.mapColumnCount=(null===(t=this.level.mapInfo[0])||void 0===t?void 0:t.length)||0,yield Promise.all([this.generateTileMap(),this.generateBursts(),this.generateSpikes(),this.generateSmokeLayer(),this.generateDoor(),this.generateEnemies()]),yield this.generatePlayer(),yield c.Instance.fadeOut(),this.hasInited=!0):this.quitBattle()}));return function(){return t.apply(this,arguments)}}(),h.quitBattle=function(){this.node.destroy(),O.loadScene(k.Start)},h.clearLevel=function(){this.stage.destroyAllChildren(),r.Instance.reset()},h.generateStage=function(){this.stage=W(),this.stage.setParent(this.node),this.stage.setSiblingIndex(2),this.stage.addComponent(Ue)},h.generateTileMap=function(){var t=i((function*(){var t=W();t.setParent(this.stage);var e=t.addComponent(se);yield e.init(),this.adaptMapPos()}));return function(){return t.apply(this,arguments)}}(),h.adaptMapPos=function(){var t=r.Instance,e=t.mapRowCount,n=t.mapColumnCount,i=z*e/2,s=q*n/2+80;this.stage.getComponent(Ue).stop(),this.stage.setPosition(-i,s)},h.generatePlayer=function(){var t=i((function*(){var t=W();t.setParent(this.stage);var e=t.addComponent(ie);yield e.init(this.level.player),r.Instance.player=e,a.Instance.emit(F.PLAYER_BORN,!0)}));return function(){return t.apply(this,arguments)}}(),h.generateEnemies=function(){var t=i((function*(){r.Instance.enemies=[];for(var t=[],e=0;e<this.level.enemies.length;e++){var n=this.level.enemies[e],i=W();i.setParent(this.stage);var s=n.type===N.SKELETON_WOODEN?Ct:vt,a=i.addComponent(s);t.push(a.init(n)),r.Instance.enemies.push(a)}yield Promise.all(t)}));return function(){return t.apply(this,arguments)}}(),h.generateBursts=function(){var t=i((function*(){for(var t=[],e=0;e<this.level.bursts.length;e++){var n=this.level.bursts[e],i=W();i.setParent(this.stage);var s=i.addComponent(me);t.push(s.init(n)),r.Instance.bursts.push(s)}yield Promise.all(t)}));return function(){return t.apply(this,arguments)}}(),h.generateSpikes=function(){var t=i((function*(){for(var t=[],e=0;e<this.level.spikes.length;e++){var n=this.level.spikes[e],i=W();i.setParent(this.stage);var s=i.addComponent(_e);t.push(s.init(n)),r.Instance.spikes.push(s)}yield Promise.all(t)}));return function(){return t.apply(this,arguments)}}(),h.generateDoor=function(){var t=i((function*(){var t=W();t.setParent(this.stage);var e=t.addComponent(fe);yield e.init(this.level.door),r.Instance.door=e}));return function(){return t.apply(this,arguments)}}(),h.generateSmoke=function(){var t=i((function*(t,e,n){var i=r.Instance.smokes.find((function(t){return t.state===_.DEATH}));if(i)i.x=t,i.y=e,i.node.setPosition(i.x*z-82.5,-i.y*q+82.5),i.direction=n,i.state=_.IDLE;else{var s=W();s.setParent(this.smokeLayer);var a=s.addComponent(ke);yield a.init({x:t,y:e,direction:n,state:_.IDLE,type:N.SMOKE}),r.Instance.smokes.push(a)}}));return function(e,n,i){return t.apply(this,arguments)}}(),h.generateSmokeLayer=function(){var t=i((function*(){this.smokeLayer=W(),this.smokeLayer.setParent(this.stage)}));return function(){return t.apply(this,arguments)}}(),h.nextLevel=function(){r.Instance.levelIndex++,console.log(r.Instance.levelIndex),this.initLevel()},h.checkArrived=function(){var t=r.Instance.door,e=t.x,n=t.y,i=t.state,s=r.Instance.player,o=s.x,h=s.y;e===o&&n===h&&i===_.DEATH&&a.Instance.emit(F.NEXT_LEVEL)},h.record=function(){var t={player:{x:r.Instance.player.targetX,y:r.Instance.player.targetY,state:r.Instance.player.state===_.IDLE||r.Instance.player.state===_.DEATH||r.Instance.player.state===_.AIRDEATH?r.Instance.player.state:_.IDLE,direction:r.Instance.player.direction,type:r.Instance.player.type},door:{x:r.Instance.door.x,y:r.Instance.door.y,state:r.Instance.door.state,direction:r.Instance.door.direction,type:r.Instance.door.type},enemies:r.Instance.enemies.map((function(t){return{x:t.x,y:t.y,state:t.state,direction:t.direction,type:t.type}})),spikes:r.Instance.spikes.map((function(t){return{x:t.x,y:t.y,count:t.count,type:t.type}})),bursts:r.Instance.bursts.map((function(t){return{x:t.x,y:t.y,state:t.state,direction:t.direction,type:t.type}}))};r.Instance.records.push(t)},h.revoke=function(){var t=r.Instance.records.pop();if(t){r.Instance.player.x=r.Instance.player.targetX=t.player.x,r.Instance.player.y=r.Instance.player.targetY=t.player.y,r.Instance.player.state=t.player.state,r.Instance.player.direction=t.player.direction;for(var e=0;e<t.enemies.length;e++){var n=t.enemies[e];r.Instance.enemies[e].x=n.x,r.Instance.enemies[e].y=n.y,r.Instance.enemies[e].state=n.state,r.Instance.enemies[e].direction=n.direction}for(var i=0;i<t.spikes.length;i++){var s=t.spikes[i];r.Instance.spikes[i].x=s.x,r.Instance.spikes[i].y=s.y,r.Instance.spikes[i].count=s.count}for(var a=0;a<t.bursts.length;a++){var o=t.bursts[a];r.Instance.bursts[a].x=o.x,r.Instance.bursts[a].y=o.y,r.Instance.bursts[a].state=o.state}r.Instance.door.x=t.door.x,r.Instance.door.y=t.door.y,r.Instance.door.state=t.door.state,r.Instance.door.direction=t.door.direction}},o}(T));p._RF.pop(),p._RF.push({},"9ae07vNWQVKI78+H+eSZJIP","MenuManager",void 0);var Ve,Xe,Ze,ze,qe;(0,f.ccclass)("MenuManager")(Ye=function(e){function n(){return e.apply(this,arguments)||this}t(n,e);var i=n.prototype;return i.handleRevoke=function(){a.Instance.emit(F.REVOKE_STEP)},i.handleRestart=function(){a.Instance.emit(F.RESTART_LEVEL)},i.handleOut=function(){a.Instance.emit(F.QUIT_BATTLE)},n}(T));p._RF.pop(),p._RF.push({},"a4cfb5Lk4FE0LKOiaKhBjZV","LoadingManager",void 0);var je,Je=f.ccclass,Qe=f.property;Ve=Je("LoadingManager"),Xe=Qe(L),Ve((qe=u((ze=function(e){function s(){for(var t,i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];return t=e.call.apply(e,[this].concat(s))||this,l(n(t),"bar",qe,n(t)),t}t(s,e);var a=s.prototype;return a.onLoad=function(){this.preLoad()},a.preLoad=function(){var t=this;O.preloadScene(k.Start),y.preloadDir("texture",(function(e,n){t.bar.progress=e/n}),function(){var e=i((function*(e){if(e)return yield new Promise((function(t){setTimeout(t,2e3)})),void t.preLoad();O.loadScene(k.Start)}));return function(t){return e.apply(this,arguments)}}())},s}(T)).prototype,"bar",[Xe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ze=ze));p._RF.pop(),p._RF.push({},"e1f034VD2tNOLeMgY7cspIy","StartManager",void 0);var $e;(0,f.ccclass)("StartManager")(je=function(e){function n(){return e.apply(this,arguments)||this}t(n,e);var s=n.prototype;return s.onLoad=function(){O.preloadScene(k.Battle),c.Instance.fadeOut(1e3),this.node.once(S.EventType.TOUCH_START,this.handleStart,this)},s.handleStart=function(){var t=i((function*(){yield c.Instance.fadeIn(300),O.loadScene(k.Battle)}));return function(){return t.apply(this,arguments)}}(),n}(T));p._RF.pop(),p._RF.push({},"ede2a0/UrtGk4YoVc9P7bIP","ControllerManager",void 0);var tn=f.ccclass;f.property,tn("ControllerManager")($e=function(e){function n(){return e.apply(this,arguments)||this}return t(n,e),n.prototype.handleCtrl=function(t,e){a.Instance.emit(F.PLAYER_CTRL,e)},n}(T));p._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///main.js'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});