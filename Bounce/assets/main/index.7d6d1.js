System.register("chunks:///main.js",["cc"],(function(t,e){"use strict";var i,n,r,o,a,s,u,h,l,c,p,d,_,f,g,m,A,R,P,E,v,S,T,M,b;return{setters:[function(t){i=t.cclegacy,n=t.director,r=t.Director,o=t.Canvas,a=t.Camera,s=t.game,u=t.Vec3,h=t._decorator,l=t.AudioClip,c=t.AudioSource,p=t.Component,d=t.instantiate,_=t.NodePool,f=t.Texture2D,g=t.Prefab,m=t.Node,A=t.ParticleUtils,R=t.find,P=t.Label,E=t.Animation,v=t.MeshRenderer,S=t.ParticleSystem,T=t.Color,M=t.Widget,b=t.SpriteComponent}],execute:function(){i._RF.push({},"4144fmK8HZAn4CiuF3twv5O","migrate-canvas",void 0);var t=1048575;function e(t,i){for(var n=0,r=t.children.length;n<r;n++)t.children[n].layer=i,e(t.children[n],i)}n.on(r.EVENT_AFTER_SCENE_LAUNCH,(function(){var i,r,u,h=null==(i=n.getScene())?void 0:i.children,l=null==(r=n.getScene())?void 0:r.getComponentsInChildren(o);if(!(l.length<=1)){l=l.filter((function(t){return!!t.cameraComponent}));var c=null==(u=n.getScene())?void 0:u.getComponentsInChildren(a),p=0;c.forEach((function(e){return p|=e.visibility&t}));for(var d=[],_=0,f=h.length;_<f;_++){var g=h[_];if(s.isPersistRootNode(g)){var m=g.getComponentsInChildren(o);0!==m.length&&d.push.apply(d,m.filter((function(t){return!!t.cameraComponent})))}}d.forEach((function(i){if(l.find((function(e){return e!==i&&e.cameraComponent.visibility&i.cameraComponent.visibility&t}))){var n=~p,r=n&~(n-1);i.cameraComponent.visibility=r|4293918720&i.cameraComponent.visibility,e(i.node,r),p|=n}}))}}));var D,O,y,N,L=cc.Node.prototype.setParent;function I(t){var e=null,i=t.getComponent(o);return i&&i.cameraComponent?e=i.cameraComponent.visibility&i.node.layer?i.node.layer:i.cameraComponent.visibility&~(i.cameraComponent.visibility-1):(t.parent&&(e=I(t.parent)),e)}cc.Node.prototype.setParent=function(t,i){if(L.call(this,t,i),t){var n=I(this);n&&(this.layer=n,e(this,n))}},i._RF.pop(),i._RF.push({},"d9bbf8RNxZP/qHAzCKjmpIn","constants",void 0),function(t){t[t.NORMAL=0]="NORMAL",t[t.SPRING=1]="SPRING",t[t.DROP=2]="DROP",t[t.GIANT=3]="GIANT",t[t.SPRINT=4]="SPRINT"}(D||(D={})),function(t){t[t.READY=1]="READY",t[t.PLAYING=2]="PLAYING",t[t.PAUSE=3]="PAUSE",t[t.OVER=4]="OVER"}(O||(O={})),function(t){t.RESTART="restart",t.REVIVE="revive",t.ADDSCORE="add-score",t.DYING="dying",t.HIDETIPS="hide-tips",t.OPENLEVEL="open-level",t.CONTINUELEVEL="continue-level"}(y||(y={})),function(t){t[t.JUMPUP=1]="JUMPUP",t[t.FALLDOWN=2]="FALLDOWN",t[t.SPRINT=3]="SPRINT"}(N||(N={}));var B,C,w,F,x,G,U,V=function(){};function H(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function J(t,e,i){return e&&H(t.prototype,e),i&&H(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function Y(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,z(t,e)}function z(t,e){return(z=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function X(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function W(t,e,i,n){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function j(t,e,i,n,r){var o={};return Object.keys(n).forEach((function(t){o[t]=n[t]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=i.slice().reverse().reduce((function(i,n){return n(t,e,i)||i}),o),r&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(r):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(t,e,o),o=null),o}V.game=void 0,V.COEFF_POS_BALL=8/360,V.PLAYER_MAX_DOWN_FRAMES=40,V.MAX_SCORE=0,V.LEVEL=1,V.SCORE_BOARD_CENTER=2,V.SCORE_BOARD_NOT_CENTER=1,V.BOARD_INIT_POS=new u(0,10,0),V.BOARD_NUM=6,V.BOARD_NEW_INDEX=2,V.BOARD_HEIGTH=.25,V.BOARD_RADIUS=1.5,V.BOARD_HEIGTH_SCALE_DROP=.5,V.BOARD_RADIUS_SCALE_GIANT=2.8,V.BOARD_GAP=4.3,V.BOARD_GAP_SPRING=9,V.BOARD_GAP_SPRINT=192,V.BOARD_SCALE_GIANT=2.8,V.SCENE_MAX_OFFSET_X=3.5,V.BOARD_TYPE=D,V.BOARD_DROP_FRAMES=40,V.BOARD_DROP_STEP=.5,V.BOARD_RADIUS_CENTER=.35,V.BOARD_SPRING_FRAMES=10,V.BOARD_WAVE_FRAMES=16,V.BOARD_WAVE_INNER_START_FRAMES=8,V.BOARD_WAVE_INNER_STEP=.24,V.BOARD_WAVE_STEP=2.25,V.BOARD_MOVING_STEP=.03,V.SPRING_HEIGHT=.2,V.SPRING_HELIX_STEP=.5,V.SPRING_HELIX_STEP_SPIRNT=1.2,V.SPRING_TOP_STEP=.25,V.SPRING_TOP_STEP_SPRINT=.5,V.WAVE_OFFSET_Y=.065,V.CAMERA_INIT_POS=new u(0,15,22),V.CAMERA_INIT_ROT=new u(-11,0,0),V.CAMERA_MOVE_X_FRAMES=20,V.CAMERA_MOVE_Y_FRAMES=15,V.CAMERA_MOVE_Y_FRAMES_SPRING=23,V.CAMERA_MOVE_MINI_ERR=.02,V.CAMERA_OFFSET_Y=10,V.CAMERA_OFFSET_Y_SPRINT=15,V.BOARD_BUMP_FRAMES=10,V.BOARD_BUMP_STEP=[-.15,-.1,-.07,-.02,-.003,.003,.02,.07,.1,.15],V.GAME_STATE=O,V.GAME_EVENT=y,V.BALL_RADIUS=.5,V.BALL_JUMP_STATE=N,V.BALL_JUMP_FRAMES=20,V.BALL_JUMP_FRAMES_SPRING=27,V.BALL_JUMP_FRAMES_SPRINT=240,V.BALL_JUMP_STEP=[.8,.6,.5,.4,.3,.2,.15,.1,.05,.03],V.BALL_JUMP_STEP_SPRING=[1.2,.8,.6,.4,.3,.2,.15,.1,.05],V.BALL_JUMP_STEP_SPRINT=.8,V.BALL_SPRINT_STEP_Y=10,V.DIAMOND_NUM=10,V.DIAMOND_PIECE_NUM=10,V.DIAMOND_RADIUS=.3,V.DIAMOND_ROTATE_STEP_Y=1.5,V.DIAMOND_SCORE=1,V.DIAMOND_SCORE_AREA=.6,V.DIAMOND_SPRINT_SCORE_AREA=1,V.DIAMOND_SPRINT_STEP_Y=4,V.DIAMOND_START_FRAME=6,V.normalDt=1/60,V.CURRENT_LEVEL=1,V.LEVEL_STEP=30,i._RF.pop(),i._RF.push({},"52ff6Qg0MlJaaUpLNS1HPTJ","audio-manager",void 0);var k=h.ccclass,q=h.property,K=(B=k("AudioManager"),C=q(l),w=q(l),B((G=j((x=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return W(e=t.call.apply(t,[this].concat(n))||this,"bg",G,X(e)),W(e,"click",U,X(e)),e.audioComp=null,e}Y(e,t);var i=e.prototype;return i.start=function(){this.audioComp=this.getComponent(c)},i.playSound=function(t){void 0===t&&(t=!0),t?(this.audioComp.clip=this.bg,this.audioComp.play()):this.audioComp.stop()},i.playClip=function(){this.audioComp.playOneShot(this.click)},e}(p)).prototype,"bg",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=j(x.prototype,"click",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=x))||F);i._RF.pop(),i._RF.push({},"dddce/2a/tOSLUiRKNMAQVd","utils",void 0);h.ccclass,h.property;var Q,Z,$=function(t,e,i){return(i*t+1)/(1*t+((i+1)/e-1))};i._RF.pop(),i._RF.push({},"f92c3xOcsdMEKh7W/84QPrD","pool-manager",void 0);var tt,et,it,nt,rt,ot,at,st,ut,ht,lt,ct,pt,dt,_t,ft,gt,mt=h.ccclass,At=(h.property,mt("PoolManager")(((Z=function(){function t(){this.dictPool={},this.dictPrefab={}}var e=t.prototype;return e.getNode=function(t,e){var i=t.data.name;this.dictPrefab[i]=t;var n=null;if(this.dictPool.hasOwnProperty(i)){var r=this.dictPool[i];n=r.size()>0?r.get():d(t)}else{var o=new _;this.dictPool[i]=o,n=d(t)}return n.parent=e,n},e.putNode=function(t){var e=t.name,i=null;this.dictPool.hasOwnProperty(e)?i=this.dictPool[e]:(i=new _,this.dictPool[e]=i),i.put(t)},e.clearPool=function(t){this.dictPool.hasOwnProperty(t)&&this.dictPool[t].clear()},J(t,null,[{key:"instance",get:function(){return this._instance||(this._instance=new t),this._instance}}]),t}())._instance=void 0,Q=Z))||Q);i._RF.pop(),i._RF.push({},"900c8pQ81tCcrbRdvi9SxTB","ball",void 0);var Rt=h.ccclass,Pt=h.property,Et=new u,vt=(tt=Rt("Ball"),et=Pt({type:f}),it=Pt({type:f}),nt=Pt({type:f}),rt=Pt({type:f}),ot=Pt(g),at=Pt({type:g}),st=Pt({type:g}),tt((lt=j((ht=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return W(e=t.call.apply(t,[this].concat(n))||this,"bgtexture1",lt,X(e)),W(e,"bgtexture2",ct,X(e)),W(e,"texture1",pt,X(e)),W(e,"texture2",dt,X(e)),W(e,"diamondParticlePrefab",_t,X(e)),W(e,"scoreAniPrefab",ft,X(e)),W(e,"trail02Prefab",gt,X(e)),e.currBoard=null,e.boardCount=0,e.jumpState=V.BALL_JUMP_STATE.JUMPUP,e.currBoardIdx=0,e.diffLevel=1,e.currJumpFrame=0,e.hasSprint=!1,e.isTouch=!1,e.touchPosX=0,e.movePosX=0,e.isJumpSpring=!1,e.boardGroupCount=0,e.trailNode=null,e.timeScale=0,e.levelBoardNumber=6,e._wPos=new u,e}Y(e,t);var i=e.prototype;return i.start=function(){V.game.node.on(m.EventType.TOUCH_START,this.onTouchStart,this),V.game.node.on(m.EventType.TOUCH_END,this.onTouchEnd,this),V.game.node.on(m.EventType.TOUCH_MOVE,this.onTouchMove,this),V.game.node.on(V.GAME_EVENT.RESTART,this.gameStart,this),V.game.node.on(V.GAME_EVENT.CONTINUELEVEL,this.gameStart,this),this.updateBall(),this.reset()},i.continueGame=function(){this.levelBoardNumber=6},i.onDestroy=function(){V.game.node.off(m.EventType.TOUCH_START,this.onTouchStart,this),V.game.node.off(m.EventType.TOUCH_END,this.onTouchEnd,this),V.game.node.off(m.EventType.TOUCH_MOVE,this.onTouchMove,this),V.game.node.off(V.GAME_EVENT.RESTART,this.gameStart,this)},i.update=function(t){if(this.timeScale=Math.floor(t/V.normalDt*100)/100,V.game.state===V.GAME_STATE.PLAYING){var e=V.game.boardManager,i=e.getBoardList();if(this.jumpState===V.BALL_JUMP_STATE.SPRINT){this.currJumpFrame>V.BALL_JUMP_FRAMES_SPRINT&&(this.jumpState=V.BALL_JUMP_STATE.JUMPUP,this.isJumpSpring=!1,this.currJumpFrame=0,this.hasSprint=!1,e.clearDiamond()),this.currJumpFrame+=this.timeScale;for(var n=e.getDiamondSprintList(),r=0;r<V.DIAMOND_NUM;r++)Math.abs(this.node.position.y-n[r].position.y)<=V.DIAMOND_SPRINT_SCORE_AREA&&Math.abs(this.node.position.x-n[r].position.x)<=V.DIAMOND_SPRINT_SCORE_AREA&&(V.game.addScore(V.DIAMOND_SCORE),this.showScore(V.DIAMOND_SCORE),V.game.ball.playDiamondParticle(this.node.position),n[r].active=!1);this.setPosY(),this.setPosX(),this.touchPosX=this.movePosX;var o=this.node.position.y+V.CAMERA_OFFSET_Y_SPRINT;V.game.cameraCtrl.setOriginPosY(o)}else{for(var a=this.currBoardIdx+1;a>=0;a--){var s=i[a];if(s){var u=this.node.position,h=i[a].node.position;if(Math.abs(u.x-h.x)<=i[a].getRadius()&&Math.abs(u.y-(h.y+V.BOARD_HEIGTH))<=V.DIAMOND_SCORE_AREA&&i[a].checkDiamond(u.x),this.jumpState===V.BALL_JUMP_STATE.FALLDOWN){if(this.currJumpFrame>V.PLAYER_MAX_DOWN_FRAMES||this.currBoard.node.position.y-u.y-(V.BOARD_GAP+V.BOARD_HEIGTH)>.001)return A.stop(this.trailNode),void V.game.gameDie();if(this.isOnBoard(s)){this.currBoard=s,this.currBoardIdx=a,this.activeCurrBoard(i);break}}}}this.currJumpFrame+=this.timeScale,this.jumpState===V.BALL_JUMP_STATE.JUMPUP&&(this.isJumpSpring&&this.currJumpFrame>=V.BALL_JUMP_FRAMES_SPRING||!this.isJumpSpring&&this.currJumpFrame>=V.BALL_JUMP_FRAMES)&&(this.jumpState=V.BALL_JUMP_STATE.FALLDOWN,this.currJumpFrame=0),this.setPosY(),this.setPosX(),this.currBoard.type!==V.BOARD_TYPE.SPRINT&&V.game.cameraCtrl.setOriginPosX(this.node.position.x),this.touchPosX=this.movePosX}this.setTrailPos()}},i.onTouchStart=function(t,e){this.isTouch=!0,this.touchPosX=t.getLocation().x,this.movePosX=this.touchPosX},i.onTouchMove=function(t,e){this.movePosX=t.getLocation().x},i.onTouchEnd=function(t,e){this.isTouch=!1},i.gameStart=function(){this.playTrail()},i.reset=function(){this.boardCount=0,this.diffLevel=1,Et.set(V.BOARD_INIT_POS),Et.y+=V.BALL_RADIUS+V.BOARD_HEIGTH/2-.001,this.node.setPosition(Et),this.node.eulerAngles=new u,this.currJumpFrame=0,this.jumpState=V.BALL_JUMP_STATE.FALLDOWN,this.hasSprint=!1,this.currBoardIdx=0,this.show(),this.setTrailPos()},i.gameContinue=function(){this.boardCount=0,Et.set(V.BOARD_INIT_POS),Et.y+=V.BALL_RADIUS+V.BOARD_HEIGTH/2-.001,this.node.setPosition(Et),this.node.eulerAngles=new u,this.currJumpFrame=0,this.jumpState=V.BALL_JUMP_STATE.FALLDOWN,this.hasSprint=!1,this.currBoardIdx=0,this.levelBoardNumber=6,this.show(),this.setTrailPos()},i.restLevel=function(){this.levelBoardNumber=6},i.updateBall=function(){this.trailNode=At.instance.getNode(this.trail02Prefab,this.node.parent)},i.show=function(){this.node.active=!0},i.hide=function(){this.node.active=!1},i.activeCurrBoard=function(t){var e=this.node.position,i=this.currBoard.node.position,n=this.currBoard.type,r=i.y+V.BALL_RADIUS+this.currBoard.getHeight()/2-.01;if(this.node.setPosition(e.x,r,e.z),this.currJumpFrame=0,n===V.BOARD_TYPE.SPRINT?(this.jumpState=V.BALL_JUMP_STATE.SPRINT,V.game.cameraCtrl.setOriginPosX(i.x)):this.jumpState=V.BALL_JUMP_STATE.JUMPUP,!this.currBoard.isActive){this.currBoard.isActive=!0;var o=V.SCORE_BOARD_NOT_CENTER;(n!==V.BOARD_TYPE.NORMAL&&n!==V.BOARD_TYPE.DROP||Math.abs(e.x-i.x)<=V.BOARD_RADIUS_CENTER)&&(o=V.SCORE_BOARD_CENTER),V.game.addScore(o),this.showScore(o),this.boardCount++,5===this.boardCount&&V.game.node.emit(V.GAME_EVENT.HIDETIPS),this.diffLevel+=o/2;for(var a=this.currBoardIdx-V.BOARD_NEW_INDEX;a>0;a--)this.levelBoardNumber<=V.LEVEL_STEP&&this.newBoard()}this.isJumpSpring=n===V.BOARD_TYPE.SPRING,this.currBoard.setBump(),this.currBoard.setWave(),n!=V.BOARD_TYPE.SPRING&&n!=V.BOARD_TYPE.SPRINT||this.currBoard.setSpring();var s=V.game.boardManager.getBoardList();if(n===V.BOARD_TYPE.DROP)for(var u=0;u<this.currBoardIdx;u++)s[u].setDrop();var h=i.y+V.CAMERA_OFFSET_Y;V.game.cameraCtrl.setOriginPosY(h),V.game.cameraCtrl.preType=n,t.length-1===this.currBoardIdx&&this.levelBoardNumber>=V.LEVEL_STEP&&V.game.openLevelResult()},i.newBoard=function(){var t=V.BOARD_TYPE.NORMAL;if(this.boardGroupCount<=0){var e=$(this.diffLevel,1,10),i=Math.random()*e;i<4.2?(t=V.BOARD_TYPE.NORMAL,this.boardGroupCount=2):i<=5.5?(t=V.BOARD_TYPE.GIANT,this.boardGroupCount=3):i<=6.2?(t=V.BOARD_TYPE.SPRING,Math.random()>.5&&(this.boardGroupCount=2)):i<=7?(t=V.BOARD_TYPE.DROP,this.boardGroupCount=3):i<=7.5&&!1===this.hasSprint?(t=V.BOARD_TYPE.SPRINT,this.hasSprint=!0):t=V.BOARD_TYPE.NORMAL}this.boardGroupCount--,this.levelBoardNumber+=1,V.game.boardManager.newBoard(t,this.diffLevel)},i.showScore=function(t){console.log("122",t);var e=At.instance.getNode(this.scoreAniPrefab,R("Canvas/resultUI")),i=new u,n=V.game.cameraCtrl.node.getComponent(a);this._wPos.set(this.node.worldPosition),n.convertToUINode(this._wPos,R("Canvas/resultUI"),i),i.x+=50,e.setPosition(i),e.getComponentInChildren(P).string="+"+t;var r=e.getComponent(E);r.once(E.EventType.FINISHED,(function(){At.instance.putNode(e)})),r.play(),this.switchBallbg()},i.switchBallbg=function(){if(V.game.score%10==0){var t,e,i,n,r=null==(t=this.node.getChildByName("RootNode"))||null==(e=t.getChildByName("Sphere001"))?void 0:e.getComponent(v),o=null==r||null==(i=r.material)?void 0:i.getProperty("albedoMap");null==r||null==(n=r.material)||n.setProperty("albedoMap",o===this.texture1?this.texture2:this.texture1)}if(V.game.score%20==0){var a,s=null==(a=R("planeBg01/RootNode/Plane001"))?void 0:a.getComponent(v);if(console.log(s,"bg"),s){var u,h,l=null==s||null==(u=s.material)?void 0:u.getProperty("albedoMap");console.log(l,"currentMaterial",this.bgtexture1,"this.bgtexture1",this.bgtexture2),null==s||null==(h=s.material)||h.setProperty("albedoMap",l===this.bgtexture1?this.bgtexture2:this.bgtexture1)}}},i.setPosX=function(){if(this.isTouch&&this.touchPosX!==this.movePosX)if(Et.set(this.node.position),this.jumpState===V.BALL_JUMP_STATE.SPRINT){var t=(this.movePosX-this.touchPosX)*V.COEFF_POS_BALL;this.node.setPosition(Et.x+t,Et.y,Et.z),Et.set(this.node.position),t=Et.x;var e=1.3*V.SCENE_MAX_OFFSET_X,i=this.currBoard.node.position;t>i.x+e?this.node.setPosition(i.x+e,Et.y,Et.z):t<this.currBoard.node.position.x-e&&this.node.setPosition(i.x-e,Et.y,Et.z)}else{var n=(this.movePosX-this.touchPosX)*V.COEFF_POS_BALL;this.node.setPosition(Et.x+n,Et.y,Et.z)}},i.setPosY=function(){if(Et.set(this.node.position),this.jumpState===V.BALL_JUMP_STATE.JUMPUP)this.isJumpSpring?Et.y+=V.BALL_JUMP_STEP_SPRING[Math.floor(this.currJumpFrame/3)]*this.timeScale:Et.y+=V.BALL_JUMP_STEP[Math.floor(this.currJumpFrame/2)]*this.timeScale,this.node.setPosition(Et);else if(this.jumpState===V.BALL_JUMP_STATE.FALLDOWN){if(this.currBoard.type===V.BOARD_TYPE.SPRING)if(this.currJumpFrame<V.BALL_JUMP_FRAMES_SPRING){var t=V.BALL_JUMP_FRAMES_SPRING-this.currJumpFrame-1;Et.y-=V.BALL_JUMP_STEP_SPRING[Math.floor((t>=0?t:0)/3)]*this.timeScale}else Et.y-=V.BALL_JUMP_STEP_SPRING[0]*this.timeScale;else if(this.currJumpFrame<V.BALL_JUMP_FRAMES){var e=V.BALL_JUMP_FRAMES-this.currJumpFrame-1;Et.y-=V.BALL_JUMP_STEP[Math.floor((e>=0?e:0)/2)]*this.timeScale}else Et.y-=V.BALL_JUMP_STEP[0]*this.timeScale;this.node.setPosition(Et)}else this.jumpState===V.BALL_JUMP_STATE.SPRINT&&(Et.y+=V.BALL_JUMP_STEP_SPRINT*this.timeScale,this.node.setPosition(Et),this.currJumpFrame>=V.DIAMOND_START_FRAME+20&&this.currJumpFrame<=V.BALL_JUMP_FRAMES_SPRINT-50&&Math.floor(this.currJumpFrame)%Math.floor(V.DIAMOND_SPRINT_STEP_Y/V.BALL_JUMP_STEP_SPRINT)==0&&V.game.boardManager.newDiamond())},i.isOnBoard=function(t){var e=this.node.position,i=t.node.position,n=Math.abs(e.x-i.x),r=e.y-i.y;if(n<=t.getRadius()){if(r>=0&&r<=V.BALL_RADIUS+t.getHeight()/2)return!0;if(this.isJumpSpring&&this.currJumpFrame>=V.BALL_JUMP_FRAMES_SPRING){if(Math.abs(r)<V.BALL_JUMP_STEP_SPRING[0])return!0}else if(!this.isJumpSpring&&this.currJumpFrame>=V.BALL_JUMP_FRAMES&&Math.abs(r)<V.BALL_JUMP_STEP[0])return!0}return!1},i.revive=function(){this.currBoardIdx--,this.currBoard.type===V.BOARD_TYPE.SPRINT&&(this.currBoardIdx++,this.currBoard=V.game.boardManager.getBoardList()[this.currBoardIdx]),this.currBoard.revive();var t=this.currBoard.node.position.clone();t.y+=V.BALL_RADIUS+this.currBoard.getHeight()/2-.001,this.node.setPosition(t),this.node.eulerAngles=new u(0,0,0),this.currJumpFrame=0,this.show();var e=this.currBoard.node.position.y+V.CAMERA_OFFSET_Y;V.game.cameraCtrl.setOriginPosX(t.x),V.game.cameraCtrl.setOriginPosY(e),this.playTrail(),this.setTrailPos()},i.playDiamondParticle=function(t){var e=this,i=At.instance.getNode(this.diamondParticlePrefab,this.node.parent);i.setPosition(t);var n=i.getComponent(S);n.play();this.schedule((function t(){n.isPlaying||(At.instance.putNode(i),e.unschedule(t))}),.1)},i.playTrail=function(){A.play(this.trailNode)},i.setTrailPos=function(){var t=this.node.position;this.trailNode.setPosition(t.x,t.y-.1,t.z)},e}(p)).prototype,"bgtexture1",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ct=j(ht.prototype,"bgtexture2",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pt=j(ht.prototype,"texture1",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dt=j(ht.prototype,"texture2",[rt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_t=j(ht.prototype,"diamondParticlePrefab",[ot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ft=j(ht.prototype,"scoreAniPrefab",[at],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gt=j(ht.prototype,"trail02Prefab",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ut=ht))||ut);i._RF.pop();var St,Tt,Mt,bt,Dt,Ot,yt,Nt,Lt=new(function(){function t(){this._registry={},this._moduleCache={}}var e=t.prototype;return e.define=function(t,e,i){this._registry[t]={factory:e,resolveMap:i}},e.require=function(t){return this._require(t)},e.throwInvalidWrapper=function(t,e){throw new Error("Module '"+t+"' imported from '"+e+"' is expected be an ESM-wrapped CommonJS module but it doesn't.")},e._require=function(t,e){var i=this._moduleCache[t];if(i)return i.exports;var n={id:t,exports:{}};return this._moduleCache[t]=n,this._tryModuleLoad(n,t),n.exports},e._resolve=function(t,e){return this._resolveFromInfos(t,e)||this._throwUnresolved(t,e)},e._resolveFromInfos=function(t,e){var i,n;return t in cjsInfos?t:e&&null!=(i=null==(n=cjsInfos[e])?void 0:n.resolveCache[t])?i:void 0},e._tryModuleLoad=function(t,e){var i=!0;try{this._load(t,e),i=!1}finally{i&&delete this._moduleCache[e]}},e._load=function(t,e){var i=this._loadWrapper(e),n=i.factory,r=i.resolveMap,o=this._createRequire(t),a=r?this._createRequireWithResolveMap("function"==typeof r?r():r,o):o;n(t.exports,a,t)},e._loadWrapper=function(t){return t in this._registry?this._registry[t]:this._loadHostProvidedModules(t)},e._loadHostProvidedModules=function(t){return{factory:function(e,i,n){if("undefined"==typeof require)throw new Error("Current environment does not provide a require() for requiring '"+t+"'.");try{n.exports=require(t)}catch(e){throw new Error("Exception thrown when calling host defined require('"+t+"').",{cause:e})}}}},e._createRequire=function(t){var e=this;return function(i){return e._require(i,t)}},e._createRequireWithResolveMap=function(t,e){return function(i){var n=t[i];if(n)return e(n);throw new Error("Unresolved specifier "+i)}},e._throwUnresolved=function(t,e){throw new Error("Unable to resolve "+t+" from "+parent+".")},t}()),It="file:///Users/hanyuhui/cc_project/ball_paly/node_modules/randomColor/randomColor.js";Lt.define(It,(function(t,e,i,n,r){!function(e,n){if("object"==typeof t){var r=n();"object"==typeof i&&i&&i.exports&&(t=i.exports=r),t.randomColor=r}else"function"==typeof define&&define.amd?define([],n):e.randomColor=n()}(this,(function(){var t=null,e={};o("monochrome",null,[[0,0],[100,0]]),o("red",[-26,18],[[20,100],[30,92],[40,89],[50,85],[60,78],[70,70],[80,60],[90,55],[100,50]]),o("orange",[18,46],[[20,100],[30,93],[40,88],[50,86],[60,85],[70,70],[100,70]]),o("yellow",[46,62],[[25,100],[40,94],[50,89],[60,86],[70,84],[80,82],[90,80],[100,75]]),o("green",[62,178],[[30,100],[40,90],[50,85],[60,81],[70,74],[80,64],[90,50],[100,40]]),o("blue",[178,257],[[20,100],[30,86],[40,80],[50,74],[60,60],[70,52],[80,44],[90,39],[100,35]]),o("purple",[257,282],[[20,100],[30,87],[40,79],[50,70],[60,65],[70,59],[80,52],[90,45],[100,42]]),o("pink",[282,334],[[20,100],[30,90],[40,86],[60,84],[80,80],[90,75],[100,73]]);var i=[];function n(t){for(var i in t>=334&&t<=360&&(t-=360),e){var n=e[i];if(n.hueRange&&t>=n.hueRange[0]&&t<=n.hueRange[1])return e[i]}return"Color not found"}function r(e){if(null===t){var i=Math.random();return i+=.618033988749895,i%=1,Math.floor(e[0]+i*(e[1]+1-e[0]))}var n=e[1]||1,r=e[0]||0,o=(t=(9301*t+49297)%233280)/233280;return Math.floor(r+o*(n-r))}function o(t,i,n){var r=n[0][0],o=n[n.length-1][0],a=n[n.length-1][1],s=n[0][1];e[t]={hueRange:i,lowerBounds:n,saturationRange:[r,o],brightnessRange:[a,s]}}function a(t){var e=t[0];0===e&&(e=1),360===e&&(e=359),e/=360;var i=t[1]/100,n=t[2]/100,r=Math.floor(6*e),o=6*e-r,a=n*(1-i),s=n*(1-o*i),u=n*(1-(1-o)*i),h=256,l=256,c=256;switch(r){case 0:h=n,l=u,c=a;break;case 1:h=s,l=n,c=a;break;case 2:h=a,l=n,c=u;break;case 3:h=a,l=s,c=n;break;case 4:h=u,l=a,c=n;break;case 5:h=n,l=a,c=s}return[Math.floor(255*h),Math.floor(255*l),Math.floor(255*c)]}function s(t){t=3===(t=t.replace(/^#/,"")).length?t.replace(/(.)/g,"$1$1"):t;var e=parseInt(t.substr(0,2),16)/255,i=parseInt(t.substr(2,2),16)/255,n=parseInt(t.substr(4,2),16)/255,r=Math.max(e,i,n),o=r-Math.min(e,i,n),a=r?o/r:0;switch(r){case e:return[(i-n)/o%6*60||0,a,r];case i:return[60*((n-e)/o+2)||0,a,r];case n:return[60*((e-i)/o+4)||0,a,r]}}function u(t){var e=t[0],i=t[1]/100,n=t[2]/100,r=(2-i)*n;return[e,Math.round(i*n/(r<1?r:2-r)*1e4)/100,r/2*100]}return function o(h){if(void 0!==(h=h||{}).seed&&null!==h.seed&&h.seed===parseInt(h.seed,10))t=h.seed;else if("string"==typeof h.seed)t=function(t){for(var e=0,i=0;i!==t.length&&!(e>=Number.MAX_SAFE_INTEGER);i++)e+=t.charCodeAt(i);return e}(h.seed);else{if(void 0!==h.seed&&null!==h.seed)throw new TypeError("The seed value must be an integer or string");t=null}var l,c;if(null!==h.count&&void 0!==h.count){for(var p=h.count,d=[],_=0;_<h.count;_++)i.push(!1);for(h.count=null;p>d.length;){var f=o(h);null!==t&&(h.seed=t),d.push(f)}return h.count=p,d}return function(t,e){switch(e.format){case"hsvArray":return t;case"hslArray":return u(t);case"hsl":var i=u(t);return"hsl("+i[0]+", "+i[1]+"%, "+i[2]+"%)";case"hsla":var n=u(t),r=e.alpha||Math.random();return"hsla("+n[0]+", "+n[1]+"%, "+n[2]+"%, "+r+")";case"rgbArray":return a(t);case"rgb":return"rgb("+a(t).join(", ")+")";case"rgba":var o=a(t);r=e.alpha||Math.random();return"rgba("+o.join(", ")+", "+r+")";default:return function(t){var e=a(t);function i(t){var e=t.toString(16);return 1==e.length?"0"+e:e}return"#"+i(e[0])+i(e[1])+i(e[2])}(t)}}([l=function(t){if(i.length>0){var o=r(h=function(t){if(isNaN(t)){if("string"==typeof t)if(e[t]){var i=e[t];if(i.hueRange)return i.hueRange}else if(t.match(/^#?([0-9A-F]{3}|[0-9A-F]{6})$/i)){return n(s(t)[0]).hueRange}}else{var r=parseInt(t);if(r<360&&r>0)return n(t).hueRange}return[0,360]}(t.hue)),a=(h[1]-h[0])/i.length,u=parseInt((o-h[0])/a);return!0===i[u]?u=(u+2)%i.length:i[u]=!0,(o=r(h=[(h[0]+u*a)%359,(h[0]+(u+1)*a)%359]))<0&&(o=360+o),o}var h;return(o=r(h=function(t){if("number"==typeof parseInt(t)){var i=parseInt(t);if(i<360&&i>0)return[i,i]}if("string"==typeof t)if(e[t]){var n=e[t];if(n.hueRange)return n.hueRange}else if(t.match(/^#?([0-9A-F]{3}|[0-9A-F]{6})$/i)){var r=s(t)[0];return[r,r]}return[0,360]}(t.hue)))<0&&(o=360+o),o}(h),c=function(t,e){if("monochrome"===e.hue)return 0;if("random"===e.luminosity)return r([0,100]);var i=function(t){return n(t).saturationRange}(t),o=i[0],a=i[1];switch(e.luminosity){case"bright":o=55;break;case"dark":o=a-10;break;case"light":a=55}return r([o,a])}(l,h),function(t,e,i){var o=function(t,e){for(var i=n(t).lowerBounds,r=0;r<i.length-1;r++){var o=i[r][0],a=i[r][1],s=i[r+1][0],u=i[r+1][1];if(e>=o&&e<=s){var h=(u-a)/(s-o);return h*e+(a-h*o)}}return 0}(t,e),a=100;switch(i.luminosity){case"dark":a=o+20;break;case"light":o=(a+o)/2;break;case"random":o=0,a=100}return r([o,a])}(l,c,h)],h)}})),St=i.exports,i.exports.randomColor}),{}),Lt.require(It),i._RF.push({},"2a0a0QivvtEZodpOZ79qMFb","board-manager",void 0);var Bt,Ct,wt,Ft,xt,Gt,Ut,Vt,Ht,Jt,Yt,zt,Xt,Wt=h.ccclass,jt=h.property,kt=new u,qt=new u,Kt=(Tt=Wt("BoardManager"),Mt=jt(g),bt=jt(g),Tt((yt=j((Ot=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return W(e=t.call.apply(t,[this].concat(n))||this,"boardPrefab",yt,X(e)),W(e,"diamondPrefab",Nt,X(e)),e.diamondSprintList=[],e.diamondCenterX=0,e._boardList=[],e._boardInsIdx=0,e}Y(e,t);var i=e.prototype;return i.start=function(){this.initBoard(),this.initDiamond()},i.reset=function(){this._boardInsIdx=0,V.game.initFirstBoard=!1;for(var t,e=V.BOARD_INIT_POS.clone(),i=V.BOARD_TYPE.NORMAL,n=0;n<V.BOARD_NUM;n++)(t=this._boardList[n]).reset(i,e,1),e=this.getNextPos(t,1);if((t=this._boardList[0]).isActive=!0,V.game.ball.currBoard=t,this.diamondSprintList[0])for(var r=0;r<V.DIAMOND_NUM;r++)this.diamondSprintList[r].active=!1},i.initBoard=function(){for(var t=0;t<V.BOARD_NUM;t++){var e=d(this.boardPrefab);e.name=this._boardInsIdx.toString();var i=e.getComponent("Board");this.changeColor(i),this._boardInsIdx++,this.node.addChild(e),this._boardList.push(i)}this.reset()},i.changeColor=function(t){var e,i,n,r,o;null==t||null==(e=t.node)||null==(i=e.getChildByName("RootNode"))||null==(n=i.getChildByName("Cylinder001"))||null==(r=n.getComponent(v))||null==(o=r.material)||o.setProperty("mainColor",new T(St({luminosity:"light",hue:"random"})))},i.newBoard=function(t,e){var i=this._boardList[V.BOARD_NUM-1],n=this.getNextPos(i,e,kt),r=this._boardList.shift();this.changeColor(r),t===V.BOARD_TYPE.SPRINT?(this.diamondCenterX=n.x,this.setDiamond(n),r.reset(t,n,0)):r.reset(t,n,e),r.name=this._boardInsIdx.toString(),this._boardInsIdx++,this._boardList.push(r)},i.getNextPos=function(t,e,i){var n=i?i.set(t.node.position):t.node.position.clone(),r=$(e,1,2);return n.x=(Math.random()-.5)*V.SCENE_MAX_OFFSET_X*r,t.type===V.BOARD_TYPE.SPRINT&&(n.y+=V.BOARD_GAP_SPRINT,n.x=t.node.position.x),t.type===V.BOARD_TYPE.SPRING?n.y+=V.BOARD_GAP_SPRING:n.y+=V.BOARD_GAP,n},i.initDiamond=function(){for(var t=0;t<V.DIAMOND_NUM;t++)this.diamondSprintList[t]=d(this.diamondPrefab),this.node.addChild(this.diamondSprintList[t]),this.diamondSprintList[t].active=!1},i.setDiamond=function(t){var e=t.clone();e.y+=V.BALL_JUMP_STEP_SPRINT*V.DIAMOND_START_FRAME;for(var i=0;i<V.DIAMOND_NUM;i++)this.setNextDiamondPos(e),this.diamondSprintList[i].setPosition(e),this.diamondSprintList[i].active=!0},i.newDiamond=function(){qt.set(this.diamondSprintList[V.DIAMOND_NUM-1].position),this.setNextDiamondPos(qt);var t=this.diamondSprintList.shift();t.setPosition(qt),t.active=!0,this.diamondSprintList.push(t)},i.clearDiamond=function(){for(var t=0;t<V.DIAMOND_NUM;t++)this.diamondSprintList[t].active=!1},i.setNextDiamondPos=function(t){t.y+=V.DIAMOND_SPRINT_STEP_Y,t.x+=1.5*(Math.random()-.5),t.x>this.diamondCenterX+V.SCENE_MAX_OFFSET_X?t.x=this.diamondCenterX+V.SCENE_MAX_OFFSET_X:t.x<this.diamondCenterX-V.SCENE_MAX_OFFSET_X&&(t.x=this.diamondCenterX-V.SCENE_MAX_OFFSET_X)},i.getBoardList=function(){return this._boardList},i.getDiamondSprintList=function(){return this.diamondSprintList},e}(p)).prototype,"boardPrefab",[Mt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Nt=j(Ot.prototype,"diamondPrefab",[bt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Dt=Ot))||Dt);i._RF.pop(),i._RF.push({},"bb50aLcTl1FbpB7Hy0H/DT9","board",void 0);var Qt,Zt,$t,te,ee,ie=h.ccclass,ne=h.property,re=new u;Bt=ie("Board"),Ct=ne(g),wt=ne({type:g}),Ft=ne({type:g}),xt=ne({type:g}),Gt=ne({type:g}),Bt((Ht=j((Vt=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return W(e=t.call.apply(t,[this].concat(n))||this,"diamondPrefab",Ht,X(e)),W(e,"centerPrefab",Jt,X(e)),W(e,"wavePrefab",Yt,X(e)),W(e,"springTopPrefab",zt,X(e)),W(e,"springHelixPrefab",Xt,X(e)),e.isActive=!1,e.diamondList=[],e.type=V.BOARD_TYPE.NORMAL,e.wave=null,e.waveInner=null,e.waveOriginScale=new u,e.currWaveFrame=0,e.currSpringFrame=0,e.currBumpFrame=V.BOARD_BUMP_FRAMES,e.springTop=null,e.springHelix=null,e.springHelixOriginScale=new u,e.center=null,e.isMovingRight=!0,e.hasDiamond=!1,e.isMoving=!1,e.posBeforeDrop=new u,e.originScale=new u,e.currDropFrame=V.BOARD_DROP_FRAMES,e._game=null,e}Y(e,t);var i=e.prototype;return i.onLoad=function(){this.originScale.set(this.node.scale),this.initCenter(),this.initWave(),this.initSpring(),this.initDiamond(),console.log(this.node,"node")},i.update=function(){this.effectBump(),this.effectWave(),this.type!==V.BOARD_TYPE.SPRING&&this.type!==V.BOARD_TYPE.SPRINT||this.effectSpring(),this.effectDrop(),this.effectMove(),this.hasDiamond&&this.effectDiamondRotate()},i.reset=function(t,e,i){if(this.isActive=!1,this.type=t,this.node.setPosition(e),this.isMoving=!1,this.currDropFrame=V.BOARD_DROP_FRAMES,this.type!==V.BOARD_TYPE.NORMAL&&this.type!==V.BOARD_TYPE.DROP&&this.type!==V.BOARD_TYPE.SPRING||(this.isMoving=this.setMove(i)),this.type===V.BOARD_TYPE.GIANT?this.node.setScale(this.originScale.x*V.BOARD_SCALE_GIANT,this.originScale.y,this.originScale.z):this.type===V.BOARD_TYPE.DROP?(this.node.setScale(this.originScale.x,this.originScale.y*V.BOARD_HEIGTH_SCALE_DROP,this.originScale.z),this.posBeforeDrop.set(this.node.position)):this.node.setScale(this.originScale),this.springTop.active=!1,this.type!==V.BOARD_TYPE.SPRING&&this.type!==V.BOARD_TYPE.SPRINT||(this.springHelix.active=!0,this.springTop.active=!0,this.setSpringPos()),this.hasDiamond=!1,this.diamondList[0]){for(var n=0;n<5;n++)this.diamondList[n].active=!1;if(this.type===V.BOARD_TYPE.GIANT)for(var r=0;r<5;r++)this.diamondList[r].active=!0,this.hasDiamond=!0;else this.type!==V.BOARD_TYPE.NORMAL&&this.type!==V.BOARD_TYPE.DROP||Math.random()>.7&&(this.diamondList[2].active=V.game.initFirstBoard,V.game.initFirstBoard=!0,this.hasDiamond=!0);this.hasDiamond&&this.setDiamondPos()}},i.setDrop=function(){this.currDropFrame=0,this.posBeforeDrop.set(this.node.position)},i.effectDrop=function(){if(this.currDropFrame<V.BOARD_DROP_FRAMES){for(var t=0;t<5;t++)this.diamondList[t].active=!1;if(this.springTop.active){this.springHelix.active=!1;var e=this.springTop.position;this.springTop.setPosition(e.x,e.y-V.BOARD_DROP_STEP,e.z)}re.set(this.node.position),re.y-=V.BOARD_DROP_STEP,this.node.setPosition(re),this.setCenterPos(),this.currDropFrame++}},i.initDiamond=function(){for(var t=0;t<5;t++)this.diamondList[t]=d(this.diamondPrefab),this.node.parent.addChild(this.diamondList[t]),this.diamondList[t].active=!1},i.setDiamondPos=function(){for(var t=new u,e=0;e<5;e++)this.diamondList[e].active&&(t.set(this.node.position),t.x+=1.4*(e-2),t.y+=V.BOARD_HEIGTH,this.diamondList[e].setPosition(t))},i.hideDiamond=function(t){this.diamondList[t].active=!1},i.checkDiamond=function(t){if(this.hasDiamond){for(var e=!0,i=0;i<5;i++)this.diamondList[i].active&&(e=!1,Math.abs(t-this.diamondList[i].position.x)<=V.DIAMOND_SCORE_AREA&&(V.game.ball.playDiamondParticle(this.diamondList[i].position),this.hideDiamond(i),V.game.addScore(V.DIAMOND_SCORE)));e&&(this.hasDiamond=!1)}},i.effectDiamondRotate=function(){for(var t=0;t<5;t++){var e=this.diamondList[t].eulerAngles;this.diamondList[t].eulerAngles=new u(e.x,e.y+V.DIAMOND_ROTATE_STEP_Y,e.z)}},i.initSpring=function(){this.springHelix=d(this.springHelixPrefab),this.springHelixOriginScale=this.springHelix.getScale(),this.springHelix.setScale(1.5,1,1.5),this.node.parent.addChild(this.springHelix),this.springHelix.active=!1,this.currSpringFrame=2*V.BOARD_SPRING_FRAMES,this.springTop=d(this.springTopPrefab),this.node.parent.addChild(this.springTop),this.springTop.active=!1;var t=this.node.position.clone();t.y+=(V.BOARD_HEIGTH+V.SPRING_HEIGHT)/2,this.springTop.setPosition(t),this.setSpringPos()},i.setSpring=function(){this.currSpringFrame=0,this.setSpringPos(),this.springHelix.setScale(1.5,1,1.5),this.springHelix.active=!0,this.springTop.active=!0},i.setSpringPos=function(){var t=this.node.position.clone();t.y+=V.BOARD_HEIGTH/2,this.springHelix.setPosition(t),(t=this.node.position.clone()).y+=(V.BOARD_HEIGTH+V.SPRING_HEIGHT)/2,this.springTop.setPosition(t)},i.effectSpring=function(){var t=this.type===V.BOARD_TYPE.SPRINT?V.SPRING_HELIX_STEP_SPIRNT:V.SPRING_HELIX_STEP,e=this.type===V.BOARD_TYPE.SPRINT?V.SPRING_TOP_STEP_SPRINT:V.SPRING_TOP_STEP,i=this.springHelix.scale,n=this.springTop.position;this.currSpringFrame<V.BOARD_SPRING_FRAMES?(this.springHelix.setScale(i.x,i.y+t,i.z),this.springTop.setPosition(n.x,n.y+e,n.z),this.currSpringFrame++):this.currSpringFrame>=V.BOARD_SPRING_FRAMES&&this.currSpringFrame<2*V.BOARD_SPRING_FRAMES?(this.springHelix.setScale(i.x,i.y-t,i.z),this.springTop.setPosition(n.x,n.y-e,n.z),this.currSpringFrame++):this.springHelix.active=!1},i.setBump=function(){this.currBumpFrame=0},i.effectBump=function(){if(this.currBumpFrame<V.BOARD_BUMP_FRAMES){var t=this.node.position;this.node.setPosition(t.x,t.y+V.BOARD_BUMP_STEP[this.currBumpFrame],t.z),this.setCenterPos(),this.currBumpFrame++}},i.initCenter=function(){this.center=d(this.centerPrefab),this.node.parent.addChild(this.center),this.center.active=!1},i.setCenterPos=function(){var t=this.node.position.clone();t.y+=V.BOARD_HEIGTH/2,this.center.setPosition(t)},i.initWave=function(){this.wave=d(this.wavePrefab),this.node.parent.addChild(this.wave),this.wave.active=!1,this.waveInner=d(this.wavePrefab),this.node.parent.addChild(this.waveInner),this.waveInner.active=!1,this.currWaveFrame=V.BOARD_WAVE_FRAMES,this.waveOriginScale.set(this.wave.scale)},i.setWave=function(){if(this.type!=V.BOARD_TYPE.GIANT){this.currWaveFrame=0;var t=this.node.position.clone();t.y+=V.WAVE_OFFSET_Y,this.wave.setPosition(t),this.wave.setScale(this.waveOriginScale.clone()),this.wave.active=!0;var e=this.wave.getComponent(v).material.passes[0],i=e.getHandle("color"),n=new T("#dadada");n.a=127,e.setUniform(i,n),this.waveInner.setPosition(t),this.waveInner.setScale(this.waveOriginScale.clone())}},i.effectWave=function(){if(this.currWaveFrame<V.BOARD_WAVE_FRAMES){if(this.currWaveFrame>=V.BOARD_WAVE_INNER_START_FRAMES){this.waveInner.active||(this.waveInner.active=!0);var t=this.waveInner.getComponent(v).material.passes[0],e=t.getHandle("color"),i=new T("#dadada");i.a=127-127*Math.sin(.05*this.currWaveFrame),t.setUniform(e,i);var n=this.waveInner.getScale();this.waveInner.setScale(n.x+V.BOARD_WAVE_INNER_STEP,n.y,n.z+V.BOARD_WAVE_INNER_STEP)}var r=this.wave.getComponent(v).material.passes[0],o=r.getHandle("color"),a=new T("#dadada");a.a=127-127*Math.sin(.1*this.currWaveFrame),r.setUniform(o,a);var s=this.waveInner.getScale();this.wave.setScale(s.x+V.BOARD_WAVE_STEP,s.y,s.z+V.BOARD_WAVE_STEP),this.currWaveFrame++}else this.wave.active=!1,this.waveInner.active=!1},i.getHeight=function(){return this.type===V.BOARD_TYPE.DROP?V.BOARD_HEIGTH*V.BOARD_HEIGTH_SCALE_DROP:V.BOARD_HEIGTH},i.getRadius=function(){return this.type===V.BOARD_TYPE.GIANT?V.BOARD_RADIUS*V.BOARD_RADIUS_SCALE_GIANT:V.BOARD_RADIUS},i.setMove=function(t){var e=$(t,1,10);return Math.random()*e>5},i.effectMove=function(){if(this.isMoving){var t=this.node.getPosition().clone(),e=t.x;this.isMovingRight&&e<=V.SCENE_MAX_OFFSET_X?(e+=V.BOARD_MOVING_STEP,this.node.setPosition(e,t.y,t.z)):this.isMovingRight&&e>V.SCENE_MAX_OFFSET_X?this.isMovingRight=!1:!this.isMovingRight&&e>=-V.SCENE_MAX_OFFSET_X?(e-=V.BOARD_MOVING_STEP,this.node.setPosition(e,t.y,t.z)):!this.isMovingRight&&e<-V.SCENE_MAX_OFFSET_X&&(this.isMovingRight=!0),this.type===V.BOARD_TYPE.SPRING&&(this.springHelix.setPosition(this.node.position.x,this.springHelix.position.y,this.springHelix.position.z),this.springTop.setPosition(this.node.position.x,this.springTop.position.y,this.springTop.position.z)),this.setCenterPos(),this.hasDiamond&&this.setDiamondPos()}},i.revive=function(){this.isActive=!1,this.isMoving=!1,this.type===V.BOARD_TYPE.DROP&&(this.currDropFrame=V.BOARD_DROP_FRAMES,this.node.setPosition(this.posBeforeDrop))},e}(p)).prototype,"diamondPrefab",[Ct],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Jt=j(Vt.prototype,"centerPrefab",[wt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Yt=j(Vt.prototype,"wavePrefab",[Ft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zt=j(Vt.prototype,"springTopPrefab",[xt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Xt=j(Vt.prototype,"springHelixPrefab",[Gt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ut=Vt));i._RF.pop(),i._RF.push({},"b5204GgQaBDNqMtOdI4KDJl","camera-ctrl",void 0);var oe,ae,se,ue,he,le,ce,pe,de,_e,fe,ge,me,Ae=h.ccclass,Re=h.property,Pe=new u,Ee=(Qt=Ae("CameraCtrl"),Zt=Re(m),Qt((ee=j((te=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return W(e=t.call.apply(t,[this].concat(n))||this,"planeNode",ee,X(e)),e.preType=V.BOARD_TYPE.NORMAL,e._originPos=new u,e}Y(e,t);var i=e.prototype;return i.start=function(){this._originPos.set(V.CAMERA_INIT_POS),this.setPosition(this._originPos),this.node.eulerAngles=V.CAMERA_INIT_ROT},i.setOriginPosX=function(t){this._originPos.x=t},i.setOriginPosY=function(t){this._originPos.y=t},i.update=function(){if(Pe.set(this.node.position),Pe.x!==this._originPos.x||Pe.y!==this._originPos.y){if(Math.abs(Pe.x-this._originPos.x)<=V.CAMERA_MOVE_MINI_ERR)Pe.x=this._originPos.x,this.setPosition(Pe);else{var t=this._originPos.x-Pe.x;Pe.x+=t/V.CAMERA_MOVE_X_FRAMES,this.setPosition(Pe)}if(Pe.set(this.node.position),Math.abs(Pe.y-this._originPos.y)<=V.CAMERA_MOVE_MINI_ERR)Pe.y=this._originPos.y,this.setPosition(Pe);else{var e=this._originPos.y-Pe.y;this.preType===V.BOARD_TYPE.SPRING?(Pe.y+=e/V.CAMERA_MOVE_Y_FRAMES_SPRING,this.setPosition(Pe)):(Pe.y+=e/V.CAMERA_MOVE_Y_FRAMES,this.setPosition(Pe))}}},i.reset=function(){this._originPos.set(V.CAMERA_INIT_POS),this.setPosition(this._originPos)},i.setPosition=function(t){this.node.setPosition(t);var e=t.y-27;this.planeNode.setPosition(t.x,e,-100)},e}(p)).prototype,"planeNode",[Zt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$t=te))||$t);i._RF.pop(),i._RF.push({},"4becfUEfe1C2prK7h8zxNvz","ui-manager",void 0);var ve,Se,Te,Me,be,De,Oe,ye,Ne,Le,Ie,Be,Ce,we=h.ccclass,Fe=h.property,xe=(oe=we("UIManager"),ae=Fe(m),se=Fe(m),ue=Fe(P),he=Fe(P),le=Fe(m),oe((de=j((pe=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return W(e=t.call.apply(t,[this].concat(n))||this,"pageStart",de,X(e)),W(e,"pageResult",_e,X(e)),W(e,"pageLevel",fe,X(e)),W(e,"currentLevel",ge,X(e)),W(e,"gameLevelResult",me,X(e)),e}Y(e,t);var i=e.prototype;return i.onLoad=function(){V.game.uiManager=this},i.start=function(){this.pageResult.active=!1,this.gameLevelResult.active=!1,this.currentLevel.string="当前关卡："+V.LEVEL.toString()},i.showGameLevelResult=function(t){this.currentLevel.string="当前关卡："+V.LEVEL.toString(),t&&(V.LEVEL+=1),this.pageLevel.string="下一关："+V.LEVEL.toString(),this.gameLevelResult.active=t},i.showDialog=function(t){this.pageResult.active=!t,this.pageStart.active=t},J(e,[{key:"levelResultActive",get:function(){return this.gameLevelResult.active}}]),e}(p)).prototype,"pageStart",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_e=j(pe.prototype,"pageResult",[se],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fe=j(pe.prototype,"pageLevel",[ue],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ge=j(pe.prototype,"currentLevel",[he],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),me=j(pe.prototype,"gameLevelResult",[le],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ce=pe))||ce);i._RF.pop(),i._RF.push({},"6b6999+5cFK4K47RCoawnB4","game",void 0);var Ge,Ue,Ve,He,Je,Ye,ze,Xe=h.ccclass,We=h.property;ve=Xe("Game"),Se=We(g),Te=We(Kt),Me=We(Ee),be=We(xe),De=We(K),ve((Ne=j((ye=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return W(e=t.call.apply(t,[this].concat(n))||this,"ballPref",Ne,X(e)),W(e,"boardManager",Le,X(e)),W(e,"cameraCtrl",Ie,X(e)),W(e,"uiManager",Be,X(e)),W(e,"audioManager",Ce,X(e)),e.initFirstBoard=!1,e.state=V.GAME_STATE.READY,e.score=0,e.hasRevive=!1,e._ball=null,e}Y(e,t);var i=e.prototype;return i.__preload=function(){V.game=this},i.onLoad=function(){if(!this.ballPref)return console.log("There is no ball!!"),void(this.enabled=!1);var t=d(this.ballPref);t.parent=this.node.parent,this._ball=t.getComponent(vt)},i.start=function(){this.node.on(V.GAME_EVENT.RESTART,this.gameStart,this),this.node.on(V.GAME_EVENT.REVIVE,this.gameRevive,this),this.node.on(V.GAME_EVENT.OPENLEVEL,this.openLevelResult,this)},i.onDestroy=function(){this.node.off(V.GAME_EVENT.RESTART,this.gameStart,this),this.node.off(V.GAME_EVENT.REVIVE,this.gameRevive,this),this.node.off(V.GAME_EVENT.OPENLEVEL,this.gameRevive,this)},i.openLevelResult=function(){this.uiManager.levelResultActive||this.uiManager.showGameLevelResult(!0)},i.gameContinue=function(){this.uiManager.showDialog(!1),this.uiManager.showGameLevelResult(!1),this.state=V.GAME_STATE.PLAYING,this._ball.gameContinue(),this.cameraCtrl.reset(),this.boardManager.reset(),this.uiManager.showGameLevelResult(!1)},i.resetGame=function(){this.state=V.GAME_STATE.READY,this._ball.reset(),this.cameraCtrl.reset(),this.boardManager.reset(),this.uiManager.showGameLevelResult(!1),this.uiManager.showDialog(!0)},i.gameStart=function(){this.audioManager.playSound(),this.uiManager.showDialog(!1),this.state=V.GAME_STATE.PLAYING,this.hasRevive=!1,this.score=0,this._ball.restLevel()},i.gameDie=function(){var t=this;this.audioManager.playSound(!1),this.state=V.GAME_STATE.PAUSE,this.node.emit(V.GAME_EVENT.DYING,(function(){t.gameOver()}))},i.gameOver=function(){this.state=V.GAME_STATE.OVER,this.audioManager.playSound(!1),this.resetGame()},i.gameRevive=function(){var t=this;this.hasRevive=!0,this.state=V.GAME_STATE.READY,this.ball.revive(),this.scheduleOnce((function(){t.audioManager.playSound(),t.state=V.GAME_STATE.PLAYING}),1)},i.addScore=function(t){this.score+=t,this.node.emit(V.GAME_EVENT.ADDSCORE,this.score)},J(e,[{key:"ball",get:function(){return this._ball}}]),e}(p)).prototype,"ballPref",[Se],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Le=j(ye.prototype,"boardManager",[Te],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ie=j(ye.prototype,"cameraCtrl",[Me],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Be=j(ye.prototype,"uiManager",[be],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ce=j(ye.prototype,"audioManager",[De],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Oe=ye));i._RF.pop(),i._RF.push({},"357cffsHiJPQrX+RLzgEYFd","gameLevelResult",void 0);var je,ke=h.ccclass,qe=h.property;Ge=ke("gameLevelResult"),Ue=qe(m),Ve=qe(m),Ge((Ye=j((Je=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return W(e=t.call.apply(t,[this].concat(n))||this,"pageContinue",Ye,X(e)),W(e,"gameOver",ze,X(e)),e}Y(e,t);var i=e.prototype;return i.start=function(){},i.update=function(t){},i.onGameContinueClick=function(){V.game.gameContinue()},i.onGameOverClick=function(){V.game.gameOver()},e}(p)).prototype,"pageContinue",[Ue],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ze=j(Je.prototype,"gameOver",[Ve],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),He=Je));i._RF.pop(),i._RF.push({},"02566VN0PhN8o7NqZg0WyFs","update-value-label",void 0);var Ke,Qe,Ze,$e,ti,ei,ii,ni,ri,oi,ai,si,ui,hi=h.ccclass,li=(h.property,hi("UpdateValueLabel")(je=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).isPlaying=!1,e.startVal=0,e.endVal=0,e.diffVal=0,e.currTime=0,e.changingTime=0,e}Y(e,t);var i=e.prototype;return i.start=function(){},i.playUpdateValue=function(t,e,i){this.startVal=t,this.endVal=e,this.diffVal=this.endVal-this.startVal,this.currTime=0,this.changingTime=i,this.string=t.toString(),this.isPlaying=!0},i.update=function(t){if(this.isPlaying){if(this.currTime<this.changingTime){this.currTime+=t;var e=this.startVal+parseInt((this.currTime/this.changingTime*this.diffVal).toString());return e<this.startVal?e=this.startVal:e>this.endVal&&(e=this.endVal),void(this.string=""+e)}this.string=""+this.endVal,this.isPlaying=!1}},e}(P))||je);i._RF.pop(),i._RF.push({},"37e87RwLXtA5LwGn6Zuq48u","revive",void 0);var ci,pi,di,_i,fi,gi,mi,Ai,Ri,Pi,Ei,vi=h.ccclass,Si=h.property,Ti=(Ke=vi("Revive"),Qe=Si(M),Ze=Si(P),$e=Si({type:P}),ti=Si({type:P}),ei=Si(b),Ke((ri=j((ni=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).closeCb=null,W(e,"wgMenu",ri,X(e)),W(e,"historyLabel",oi,X(e)),W(e,"scoreLabel",ai,X(e)),W(e,"progressLabel",si,X(e)),W(e,"spCountDown",ui,X(e)),e.pageResult=null,e.countDownTime=void 0,e.currentTime=void 0,e.isCountDowning=void 0,e}Y(e,t);var i=e.prototype;return i.onEnable=function(){this.show()},i.show=function(){var t=V.game.score;this.scoreLabel.string=t.toString(),V.MAX_SCORE<t&&(V.MAX_SCORE=t),this.historyLabel.string=V.MAX_SCORE.toString(),this.countDownTime=5,this.progressLabel.string=this.countDownTime+"",this.currentTime=0,this.spCountDown.fillRange=1,this.isCountDowning=!0},i.onBtnReviveClick=function(){this.isCountDowning=!1,V.game.audioManager.playClip(),V.game.node.emit(V.GAME_EVENT.REVIVE),this.pageResult.showResult(!1)},i.onBtnSkipClick=function(){V.game.audioManager.playClip(),this.isCountDowning=!1,V.game.gameOver()},i.update=function(t){if(this.isCountDowning){this.currentTime+=t;var e=this.countDownTime-this.currentTime;this.progressLabel.string=Math.ceil(e)+"",e<=0&&(e=0,this.isCountDowning=!1,this.onBtnSkipClick());var i=e/this.countDownTime;this.spCountDown.fillRange=i}},e}(p)).prototype,"wgMenu",[Qe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oi=j(ni.prototype,"historyLabel",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ai=j(ni.prototype,"scoreLabel",[$e],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),si=j(ni.prototype,"progressLabel",[ti],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ui=j(ni.prototype,"spCountDown",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ii=ni))||ii);i._RF.pop(),i._RF.push({},"31b007MqixM3YyJROFsTMEh","page-result",void 0);var Mi,bi=h.ccclass,Di=h.property;ci=bi("PageResult"),pi=Di({type:li}),di=Di(m),_i=Di(m),fi=Di(m),ci((Ai=j((mi=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return W(e=t.call.apply(t,[this].concat(n))||this,"scoreLabel",Ai,X(e)),e.targetProgress=0,W(e,"nodeTips1",Ri,X(e)),W(e,"nodeTips2",Pi,X(e)),W(e,"result",Ei,X(e)),e}Y(e,t);var i=e.prototype;return i.init=function(){this.targetProgress=0,this.scoreLabel.playUpdateValue(this.targetProgress,this.targetProgress,0),this.scoreLabel.isPlaying=!1},i.onEnable=function(){V.game.node.on(V.GAME_EVENT.HIDETIPS,this.hideTips,this),V.game.node.on(V.GAME_EVENT.ADDSCORE,this.addScore,this),V.game.node.on(V.GAME_EVENT.DYING,this.gameDie,this),this.showTips(!0),this.showResult(!1),this.init()},i.start=function(){this.result.getComponent(Ti).pageResult=this},i.onDisable=function(){V.game.node.off(V.GAME_EVENT.HIDETIPS,this.hideTips,this),V.game.node.off(V.GAME_EVENT.ADDSCORE,this.addScore,this)},i.addScore=function(t){this.targetProgress=t;var e=Number(this.scoreLabel.string);this.scoreLabel.playUpdateValue(e,this.targetProgress,(this.targetProgress-e)/20)},i.gameDie=function(){this.showTips(!1),this.showResult(!0)},i.showTips=function(t){this.nodeTips1.active=t,this.nodeTips2.active=t},i.hideTips=function(){this.showTips(!1)},i.showResult=function(t){this.result.active=t},e}(p)).prototype,"scoreLabel",[pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ri=j(mi.prototype,"nodeTips1",[di],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Pi=j(mi.prototype,"nodeTips2",[_i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ei=j(mi.prototype,"result",[fi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gi=mi));i._RF.pop(),i._RF.push({},"75579oVThhNcJN3jNLu42YC","page-start",void 0);var Oi=h.ccclass;h.property,Oi("PageStart")(Mi=function(t){function e(){return t.apply(this,arguments)||this}return Y(e,t),e.prototype.gameStart=function(){V.game.node.emit(V.GAME_EVENT.RESTART),V.game.audioManager.playClip()},e}(p));i._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///main.js'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});